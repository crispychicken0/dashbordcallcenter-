<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crispy Chicken LLC Center Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        /* Previous CSS remains unchanged */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        .navbar {
            background-color: #e4002b !important;
        }
        .navbar-brand {
            font-weight: bold;
            color: white !important;
        }
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border: none;
        }
        .card-header {
            background-color: #e4002b;
            color: white;
            font-weight: bold;
            border-radius: 10px 10px 0 0 !important;
            border: none;
        }
        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            border: none;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        .stat-card i {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        .stat-card h3 {
            margin-bottom: 5px;
            font-size: 1.8rem;
        }
        .stat-card p {
            color: #6c757d;
            margin-bottom: 0;
        }
        .crispy-red {
            color: #e4002b;
        }
        .crispy-bg-red {
            background-color: #e4002b;
        }
        .crispy-bg-light-red {
            background-color: #ffcccb;
        }
        .table th {
            background-color: #f8f9fa;
        }
        .nav-tabs .nav-link {
            color: #495057;
        }
        .nav-tabs .nav-link.active {
            color: #e4002b;
            font-weight: bold;
        }
        .btn-primary {
            background-color: #e4002b;
            border-color: #e4002b;
        }
        .btn-primary:hover {
            background-color: #c70025;
            border-color: #c70025;
        }
        .report-section {
            display: none;
        }
        .report-section.active {
            display: block;
        }
        .footer {
            background-color: #343a40;
            color: white;
            padding: 20px 0;
            margin-top: 30px;
        }
        .task-item {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            background-color: #f8f9fa;
            border-left: 4px solid #e4002b;
        }
        .task-item.high-priority {
            border-left-color: #dc3545;
        }
        .task-item.medium-priority {
            border-left-color: #ffc107;
        }
        .task-item.low-priority {
            border-left-color: #28a745;
        }
        .data-reference-card {
            height: 100%;
        }
        .data-reference-card .card-body {
            max-height: 300px;
            overflow-y: auto;
        }
        .dashboard-widget {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .widget-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
        }
        .widget-icon {
            font-size: 1.5rem;
            color: #e4002b;
        }
        .widget-body {
            height: 250px;
        }
        .crispy-logo {
            height: 30px;
            margin-left: 10px;
        }
        .report-header {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .report-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }
        .report-actions {
            display: flex;
            gap: 10px;
        }
        .report-metric {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .metric-label {
            font-weight: 500;
            color: #666;
        }
        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }
        .metric-change {
            font-size: 0.9rem;
        }
        .positive {
            color: #28a745;
        }
        .negative {
            color: #dc3545;
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        .performance-table {
            margin-top: 20px;
        }
        .performance-table th {
            background-color: #e4002b;
            color: white;
            border: none;
        }
        .performance-table td {
            vertical-align: middle;
        }
        .badge-crispy {
            background-color: #e4002b;
        }
        .sidebar {
            position: fixed;
            top: 56px;
            bottom: 0;
            left: 0;
            z-index: 100;
            padding: 0;
            width: 250px;
            background-color: #f8f9fa;
            border-right: 1px solid #dee2e6;
        }
        .sidebar-sticky {
            position: sticky;
            top: 0;
            height: calc(100vh - 56px);
            padding-top: 1rem;
            overflow-x: hidden;
            overflow-y: auto;
        }
        .sidebar .nav-link {
            color: #333;
            font-weight: 500;
            padding: 0.75rem 1rem;
            border-radius: 0;
        }
        .sidebar .nav-link:hover {
            color: #e4002b;
            background-color: rgba(228, 0, 43, 0.1);
        }
        .sidebar .nav-link.active {
            color: white;
            background-color: #e4002b;
        }
        .sidebar .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        .main-content {
            margin-left: 250px;
            padding: 20px;
        }
        .navbar-brand img {
            height: 30px;
        }
        .user-profile {
            display: flex;
            align-items: center;
        }
        .user-profile img {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-left: 10px;
        }
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #dc3545;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }
        .notification-item {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
        }
        .notification-item:last-child {
            border-bottom: none;
        }
        .notification-title {
            font-weight: 600;
            margin-bottom: 3px;
        }
        .notification-time {
            font-size: 0.8rem;
            color: #6c757d;
        }
        .search-box {
            position: relative;
        }
        .search-box input {
            padding-left: 35px;
            border-radius: 20px;
        }
        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }
        .data-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        .data-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .data-card-title {
            font-size: 1.2rem;
            font-weight: 600;
        }
        .data-card-action {
            color: #e4002b;
        }
        .data-table {
            margin-top: 15px;
        }
        .data-table th {
            background-color: #f8f9fa;
            border-top: none;
        }
        .filter-section {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .filter-title {
            font-weight: 600;
            margin-bottom: 15px;
        }
        .form-label {
            font-weight: 500;
            margin-bottom: 5px;
        }
        .form-control, .form-select {
            border-radius: 5px;
        }
        .btn-crispy {
            background-color: #e4002b;
            border-color: #e4002b;
            color: white;
        }
        .btn-crispy:hover {
            background-color: #c70025;
            border-color: #c70025;
            color: white;
        }
        .report-export {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
        }
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .page-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }
        .breadcrumb {
            background-color: transparent;
            padding: 0;
            margin-bottom: 0;
        }
        .breadcrumb-item + .breadcrumb-item::before {
            content: ">";
            color: #6c757d;
        }
        .breadcrumb-item.active {
            color: #e4002b;
        }
        .modal-header {
            background-color: #e4002b;
            color: white;
        }
        .modal-header .btn-close {
            filter: brightness(0) invert(1);
        }
        .form-floating label {
            color: #6c757d;
        }
        .agent-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        .status-online {
            background-color: #28a745;
        }
        .status-offline {
            background-color: #dc3545;
        }
        .status-break {
            background-color: #ffc107;
        }
        .performance-indicator {
            height: 5px;
            border-radius: 5px;
            margin-top: 5px;
        }
        .performance-high {
            background-color: #28a745;
        }
        .performance-medium {
            background-color: #ffc107;
        }
        .performance-low {
            background-color: #dc3545;
        }
        .kpi-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
            margin-bottom: 20px;
        }
        .kpi-value {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            margin: 10px 0;
        }
        .kpi-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        .kpi-change {
            font-size: 0.8rem;
            margin-top: 5px;
        }
        .report-summary {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }
        .summary-item:last-child {
            border-bottom: none;
        }
        .summary-label {
            font-weight: 500;
        }
        .summary-value {
            font-weight: bold;
        }
        .report-chart {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .report-table {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .report-table-title {
            font-weight: 600;
            margin-bottom: 15px;
        }
        .report-table table {
            margin-bottom: 0;
        }
        .report-table th {
            background-color: #f8f9fa;
            border-top: none;
        }
        .report-footer {
            text-align: right;
            margin-top: 20px;
            font-size: 0.9rem;
            color: #6c757d;
        }
        .report-logo {
            max-height: 50px;
            margin-bottom: 15px;
        }
        #map {
            height: 400px;
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
        }
        .branch-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        .branch-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .branch-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .branch-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
        }
        .branch-rating {
            color: #ffc107;
        }
        .branch-info {
            margin-bottom: 10px;
        }
        .branch-info-item {
            display: flex;
            margin-bottom: 5px;
        }
        .branch-info-label {
            font-weight: 500;
            width: 100px;
            color: #666;
        }
        .branch-info-value {
            flex: 1;
        }
        .branch-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .branch-status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        .status-open {
            background-color: #d4edda;
            color: #155724;
        }
        .status-closed {
            background-color: #f8d7da;
            color: #721c24;
        }
        @media (max-width: 992px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                top: 0;
            }
            .main-content {
                margin-left: 0;
            }
            .sidebar-sticky {
                position: relative;
                height: auto;
            }
        }
        @media (max-width: 576px) {
            .stat-card {
                margin-bottom: 15px;
            }
            .page-header {
                flex-direction: column;
                align-items: flex-start;
            }
            .page-title {
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="bi bi-shop"></i> Crispy Chicken LLC Management
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="showSection('dashboard')">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('branches')">
                            <i class="bi bi-geo-alt-fill"></i> Branches
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('tasks')">
                            <i class="bi bi-list-task"></i> Tasks
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('agents')">
                            <i class="bi bi-people-fill"></i> Agents
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('calls')">
                            <i class="bi bi-telephone-forward-fill"></i> Call Logs
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('complaints')">
                            <i class="bi bi-exclamation-triangle-fill"></i> Complaints
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('reports')">
                            <i class="bi bi-file-earmark-text-fill"></i> Reports
                        </a>
                    </li>
                </ul>
                <div class="d-flex">
                    <div class="search-box me-3">
                        <i class="bi bi-search"></i>
                        <input type="text" class="form-control" placeholder="Search...">
                    </div>
                    <div class="dropdown me-3">
                        <button class="btn btn-link position-relative text-white p-0" type="button" data-bs-toggle="dropdown">
                            <i class="bi bi-bell-fill"></i>
                            <span class="notification-badge">3</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><div class="notification-item">
                                <div class="notification-title">New complaint received</div>
                                <div class="notification-time">2 minutes ago</div>
                            </div></li>
                            <li><div class="notification-item">
                                <div class="notification-title">Agent training scheduled</div>
                                <div class="notification-time">1 hour ago</div>
                            </div></li>
                            <li><div class="notification-item">
                                <div class="notification-title">Weekly report is ready</div>
                                <div class="notification-time">3 hours ago</div>
                            </div></li>
                        </ul>
                    </div>
                    <div class="user-profile">
                        <span class="navbar-text">
                            <i class="bi bi-person-circle"></i> Manager
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-2 d-none d-md-block sidebar">
                <div class="sidebar-sticky">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" onclick="showSection('dashboard')">
                                <i class="bi bi-speedometer2"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('branches')">
                                <i class="bi bi-geo-alt-fill"></i> Branches
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('tasks')">
                                <i class="bi bi-list-task"></i> Tasks
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('agents')">
                                <i class="bi bi-people-fill"></i> Agents
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('calls')">
                                <i class="bi bi-telephone-forward-fill"></i> Call Logs
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('complaints')">
                                <i class="bi bi-exclamation-triangle-fill"></i> Complaints
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('reports')">
                                <i class="bi bi-file-earmark-text-fill"></i> Reports
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
            <!-- Main Content -->
            <main class="col-md-10 ms-sm-auto px-md-4 main-content">
                <!-- Dashboard Section -->
                <div id="dashboard" class="section">
                    <div class="page-header">
                        <div>
                            <h1 class="page-title">Dashboard</h1>
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                                    <li class="breadcrumb-item active">Dashboard</li>
                                </ol>
                            </nav>
                        </div>
                        <div class="d-flex gap-2">
                            <button class="btn btn-sm btn-outline-primary" onclick="refreshDashboard()">
                                <i class="bi bi-arrow-clockwise"></i> Refresh
                            </button>
                            <button class="btn btn-sm btn-outline-primary" onclick="exportDashboard()">
                                <i class="bi bi-download"></i> Export
                            </button>
                        </div>
                    </div>
                    <div class="row mb-4">
                        <div class="col-xl-3 col-md-6">
                            <div class="stat-card">
                                <i class="bi bi-geo-alt-fill crispy-red"></i>
                                <h3 id="totalBranches">0</h3>
                                <p>Total Branches</p>
                                <div class="metric-change positive">
                                    <i class="bi bi-arrow-up"></i> 2 new this month
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6">
                            <div class="stat-card">
                                <i class="bi bi-people-fill crispy-red"></i>
                                <h3 id="totalAgents">0</h3>
                                <p>Total Agents</p>
                                <div class="metric-change positive">
                                    <i class="bi bi-arrow-up"></i> 12% from last week
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6">
                            <div class="stat-card">
                                <i class="bi bi-telephone-fill crispy-red"></i>
                                <h3 id="todayCalls">0</h3>
                                <p>Today's Calls</p>
                                <div class="metric-change negative">
                                    <i class="bi bi-arrow-down"></i> 5% from yesterday
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6">
                            <div class="stat-card">
                                <i class="bi bi-currency-dollar crispy-red"></i>
                                <h3 id="todaySales">0</h3>
                                <p>Today's Sales (AED)</p>
                                <div class="metric-change positive">
                                    <i class="bi bi-arrow-up"></i> 15% from yesterday
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="dashboard-widget">
                                <div class="widget-header">
                                    <div class="widget-title">Sales Performance</div>
                                    <div class="widget-icon">
                                        <i class="bi bi-graph-up"></i>
                                    </div>
                                </div>
                                <div class="widget-body">
                                    <canvas id="salesChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="dashboard-widget">
                                <div class="widget-header">
                                    <div class="widget-title">Branch Distribution</div>
                                    <div class="widget-icon">
                                        <i class="bi bi-pie-chart"></i>
                                    </div>
                                </div>
                                <div class="widget-body">
                                    <canvas id="branchDistributionChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-lg-6">
                            <div class="dashboard-widget">
                                <div class="widget-header">
                                    <div class="widget-title">Top Performing Branches</div>
                                    <div class="widget-icon">
                                        <i class="bi bi-trophy-fill"></i>
                                    </div>
                                </div>
                                <div class="widget-body">
                                    <canvas id="topBranchesChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="dashboard-widget">
                                <div class="widget-header">
                                    <div class="widget-title">Call Distribution</div>
                                    <div class="widget-icon">
                                        <i class="bi bi-telephone-fill"></i>
                                    </div>
                                </div>
                                <div class="widget-body">
                                    <canvas id="callDistributionChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Branches Section -->
                <div id="branches" class="section" style="display: none;">
                    <div class="page-header">
                        <div>
                            <h1 class="page-title">Branch Management</h1>
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                                    <li class="breadcrumb-item active">Branches</li>
                                </ol>
                            </nav>
                        </div>
                        <div>
                            <button class="btn btn-primary" onclick="showAddBranchModal()">
                                <i class="bi bi-plus-circle-fill"></i> Add Branch
                            </button>
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="filter-section">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-floating">
                                            <select class="form-select" id="branchCityFilter" onchange="filterBranches()">
                                                <option value="all">All Cities</option>
                                                <option value="Abu Dhabi">Abu Dhabi</option>
                                                <option value="Dubai">Dubai</option>
                                            </select>
                                            <label for="branchCityFilter">City</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-floating">
                                            <select class="form-select" id="branchRatingFilter" onchange="filterBranches()">
                                                <option value="all">All Ratings</option>
                                                <option value="5">5 Stars</option>
                                                <option value="4">4 Stars</option>
                                                <option value="3">3 Stars</option>
                                            </select>
                                            <label for="branchRatingFilter">Rating</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-floating">
                                            <select class="form-select" id="branchStatusFilter" onchange="filterBranches()">
                                                <option value="all">All Status</option>
                                                <option value="open">Open</option>
                                                <option value="closed">Closed</option>
                                            </select>
                                            <label for="branchStatusFilter">Status</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="d-flex justify-content-end">
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-outline-primary active" onclick="setViewMode('cards')">
                                        <i class="bi bi-grid-3x3-gap-fill"></i> Cards
                                    </button>
                                    <button type="button" class="btn btn-outline-primary" onclick="setViewMode('table')">
                                        <i class="bi bi-table"></i> Table
                                    </button>
                                    <button type="button" class="btn btn-outline-primary" onclick="setViewMode('map')">
                                        <i class="bi bi-map"></i> Map
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="branchesCardsView" class="row">
                        <!-- Branch cards will be dynamically added here -->
                    </div>
                    <div id="branchesTableView" class="data-card" style="display: none;">
                        <div class="data-card-header">
                            <div class="data-card-title">Branch List</div>
                            <div class="data-card-action">
                                <span id="branchCount">0 branches</span>
                            </div>
                        </div>
                        <div class="data-table">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>City</th>
                                            <th>Area</th>
                                            <th>Rating</th>
                                            <th>Manager</th>
                                            <th>Contact</th>
                                            <th>Delivery</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="branchesTable">
                                        <tr>
                                            <td colspan="8" class="text-center">No branches found</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div id="branchesMapView" class="data-card" style="display: none;">
                        <div class="data-card-header">
                            <div class="data-card-title">Branch Locations</div>
                            <div class="data-card-action">
                                <span id="branchMapCount">0 branches</span>
                            </div>
                        </div>
                        <div id="map"></div>
                    </div>
                </div>
                <!-- Tasks Management Section -->
                <div id="tasks" class="section" style="display: none;">
                    <div class="page-header">
                        <div>
                            <h1 class="page-title">Task Management</h1>
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                                    <li class="breadcrumb-item active">Tasks</li>
                                </ol>
                            </nav>
                        </div>
                        <div>
                            <button class="btn btn-primary" onclick="showAddTaskModal()">
                                <i class="bi bi-plus-circle-fill"></i> Add Task
                            </button>
                        </div>
                    </div>
                    
                    <div class="filter-section">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-floating">
                                    <select class="form-select" id="taskStatusFilter" onchange="filterTasks()">
                                        <option value="all">All Status</option>
                                        <option value="pending">Pending</option>
                                        <option value="in-progress">In Progress</option>
                                        <option value="completed">Completed</option>
                                    </select>
                                    <label for="taskStatusFilter">Status</label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-floating">
                                    <select class="form-select" id="taskPriorityFilter" onchange="filterTasks()">
                                        <option value="all">All Priority</option>
                                        <option value="high">High</option>
                                        <option value="medium">Medium</option>
                                        <option value="low">Low</option>
                                    </select>
                                    <label for="taskPriorityFilter">Priority</label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-floating">
                                    <select class="form-select" id="taskCategoryFilter" onchange="filterTasks()">
                                        <option value="all">All Categories</option>
                                        <option value="training">Training</option>
                                        <option value="meeting">Meeting</option>
                                        <option value="follow-up">Follow-up</option>
                                        <option value="report">Report</option>
                                        <option value="maintenance">Maintenance</option>
                                    </select>
                                    <label for="taskCategoryFilter">Category</label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-floating">
                                    <input type="text" class="form-control" id="taskSearchFilter" placeholder="Search tasks" onkeyup="filterTasks()">
                                    <label for="taskSearchFilter">Search</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="data-card">
                        <div class="data-card-header">
                            <div class="data-card-title">Task List</div>
                            <div class="data-card-action">
                                <span id="taskCount">0 tasks</span>
                            </div>
                        </div>
                        <div class="data-table">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Task</th>
                                            <th>Category</th>
                                            <th>Priority</th>
                                            <th>Assigned To</th>
                                            <th>Due Date</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tasksTable">
                                        <tr>
                                            <td colspan="7" class="text-center">No tasks found</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Agents Management Section -->
                <div id="agents" class="section" style="display: none;">
                    <div class="page-header">
                        <div>
                            <h1 class="page-title">Agent Management</h1>
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                                    <li class="breadcrumb-item active">Agents</li>
                                </ol>
                            </nav>
                        </div>
                        <div>
                            <button class="btn btn-primary" onclick="showAddAgentModal()">
                                <i class="bi bi-plus-circle-fill"></i> Add Agent
                            </button>
                        </div>
                    </div>
                    
                    <div class="filter-section">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-floating">
                                    <input type="text" class="form-control" id="agentSearchFilter" placeholder="Search agents" onkeyup="filterAgents()">
                                    <label for="agentSearchFilter">Search</label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-floating">
                                    <select class="form-select" id="agentPositionFilter" onchange="filterAgents()">
                                        <option value="all">All Positions</option>
                                        <option value="Senior Agent">Senior Agent</option>
                                        <option value="Junior Agent">Junior Agent</option>
                                        <option value="Team Leader">Team Leader</option>
                                        <option value="Manager">Manager</option>
                                    </select>
                                    <label for="agentPositionFilter">Position</label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-floating">
                                    <select class="form-select" id="agentStatusFilter" onchange="filterAgents()">
                                        <option value="all">All Status</option>
                                        <option value="trained">Trained</option>
                                        <option value="not-trained">Not Trained</option>
                                    </select>
                                    <label for="agentStatusFilter">Training Status</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="data-card">
                        <div class="data-card-header">
                            <div class="data-card-title">Agent List</div>
                            <div class="data-card-action">
                                <span id="agentCount">0 agents</span>
                            </div>
                        </div>
                        <div class="data-table">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Position</th>
                                            <th>Contact</th>
                                            <th>Training</th>
                                            <th>Performance</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="agentsTable">
                                        <tr>
                                            <td colspan="7" class="text-center">No agents found</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Call Logging Section -->
                <div id="calls" class="section" style="display: none;">
                    <div class="page-header">
                        <div>
                            <h1 class="page-title">Call Logs</h1>
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                                    <li class="breadcrumb-item active">Call Logs</li>
                                </ol>
                            </nav>
                        </div>
                        <div>
                            <button class="btn btn-primary" onclick="showAddCallModal()">
                                <i class="bi bi-plus-circle-fill"></i> Log Call
                            </button>
                        </div>
                    </div>
                    
                    <div class="filter-section">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-floating">
                                    <input type="date" class="form-control" id="callDateFilter" onchange="filterCalls()">
                                    <label for="callDateFilter">Date</label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-floating">
                                    <select class="form-select" id="callTypeFilter" onchange="filterCalls()">
                                        <option value="all">All Types</option>
                                        <option value="order">Order</option>
                                        <option value="inquiry">Inquiry</option>
                                        <option value="complaint">Complaint</option>
                                    </select>
                                    <label for="callTypeFilter">Call Type</label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-floating">
                                    <select class="form-select" id="callAgentFilter" onchange="filterCalls()">
                                        <option value="all">All Agents</option>
                                    </select>
                                    <label for="callAgentFilter">Agent</label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-floating">
                                    <select class="form-select" id="callOutcomeFilter" onchange="filterCalls()">
                                        <option value="all">All Outcomes</option>
                                        <option value="order_placed">Order Placed</option>
                                        <option value="resolved">Resolved</option>
                                        <option value="escalated">Escalated</option>
                                    </select>
                                    <label for="callOutcomeFilter">Outcome</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="data-card">
                        <div class="data-card-header">
                            <div class="data-card-title">Call History</div>
                            <div class="data-card-action">
                                <span id="callCount">0 calls</span>
                            </div>
                        </div>
                        <div class="data-table">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Agent</th>
                                            <th>Type</th>
                                            <th>Duration (min)</th>
                                            <th>Outcome</th>
                                            <th>Sale Amount (AED)</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="callsTable">
                                        <tr>
                                            <td colspan="7" class="text-center">No calls found</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Complaints Section -->
                <div id="complaints" class="section" style="display: none;">
                    <div class="page-header">
                        <div>
                            <h1 class="page-title">Complaint Management</h1>
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                                    <li class="breadcrumb-item active">Complaints</li>
                                </ol>
                            </nav>
                        </div>
                        <div>
                            <button class="btn btn-primary" onclick="showAddComplaintModal()">
                                <i class="bi bi-plus-circle-fill"></i> Log Complaint
                            </button>
                        </div>
                    </div>
                    
                    <div class="filter-section">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-floating">
                                    <input type="date" class="form-control" id="complaintDateFilter" onchange="filterComplaints()">
                                    <label for="complaintDateFilter">Date</label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-floating">
                                    <select class="form-select" id="complaintTypeFilter" onchange="filterComplaints()">
                                        <option value="all">All Types</option>
                                        <option value="delivery">Delivery Delay</option>
                                        <option value="quality">Food Quality</option>
                                        <option value="order">Order Error</option>
                                        <option value="service">Customer Service</option>
                                    </select>
                                    <label for="complaintTypeFilter">Complaint Type</label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-floating">
                                    <select class="form-select" id="complaintStatusFilter" onchange="filterComplaints()">
                                        <option value="all">All Status</option>
                                        <option value="pending">Pending</option>
                                        <option value="in_progress">In Progress</option>
                                        <option value="resolved">Resolved</option>
                                    </select>
                                    <label for="complaintStatusFilter">Status</label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-floating">
                                    <select class="form-select" id="complaintAgentFilter" onchange="filterComplaints()">
                                        <option value="all">All Agents</option>
                                    </select>
                                    <label for="complaintAgentFilter">Agent</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="data-card">
                        <div class="data-card-header">
                            <div class="data-card-title">Complaint Records</div>
                            <div class="data-card-action">
                                <span id="complaintCount">0 complaints</span>
                            </div>
                        </div>
                        <div class="data-table">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Agent</th>
                                            <th>Customer ID</th>
                                            <th>Type</th>
                                            <th>Description</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="complaintsTable">
                                        <tr>
                                            <td colspan="7" class="text-center">No complaints found</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Reports Section -->
                <div id="reports" class="section" style="display: none;">
                    <div class="page-header">
                        <div>
                            <h1 class="page-title">Reports</h1>
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                                    <li class="breadcrumb-item active">Reports</li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                    
                    <ul class="nav nav-tabs" id="reportTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="daily-tab" data-bs-toggle="tab" data-bs-target="#daily" type="button" role="tab">Daily Report</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="weekly-tab" data-bs-toggle="tab" data-bs-target="#weekly" type="button" role="tab">Weekly Report</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="monthly-tab" data-bs-toggle="tab" data-bs-target="#monthly" type="button" role="tab">Monthly Report</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="branch-tab" data-bs-toggle="tab" data-bs-target="#branch" type="button" role="tab">Branch Report</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="custom-tab" data-bs-toggle="tab" data-bs-target="#custom" type="button" role="tab">Custom Report</button>
                        </li>
                    </ul>
                    
                    <div class="tab-content mt-3" id="reportTabContent">
                        <div class="tab-pane fade show active" id="daily" role="tabpanel">
                            <div class="report-card">
                                <div class="report-header">
                                    <div class="report-title">Daily Performance Report</div>
                                    <div class="report-actions">
                                        <button class="btn btn-sm btn-outline-primary" onclick="generateDailyReport()">
                                            <i class="bi bi-arrow-clockwise"></i> Generate
                                        </button>
                                        <button class="btn btn-sm btn-outline-primary" onclick="exportReport('daily')">
                                            <i class="bi bi-download"></i> Export
                                        </button>
                                    </div>
                                </div>
                                <div class="filter-section">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-floating">
                                                <input type="date" class="form-control" id="dailyDate">
                                                <label for="dailyDate">Select Date</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-floating">
                                                <select class="form-select" id="dailyBranchFilter">
                                                    <option value="all">All Branches</option>
                                                </select>
                                                <label for="dailyBranchFilter">Branch</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="dailyReportContent" class="mt-4">
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle"></i> Select a date and generate the report to view daily performance metrics.
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="weekly" role="tabpanel">
                            <div class="report-card">
                                <div class="report-header">
                                    <div class="report-title">Weekly Performance Report</div>
                                    <div class="report-actions">
                                        <button class="btn btn-sm btn-outline-primary" onclick="generateWeeklyReport()">
                                            <i class="bi bi-arrow-clockwise"></i> Generate
                                        </button>
                                        <button class="btn btn-sm btn-outline-primary" onclick="exportReport('weekly')">
                                            <i class="bi bi-download"></i> Export
                                        </button>
                                    </div>
                                </div>
                                <div class="filter-section">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-floating">
                                                <input type="date" class="form-control" id="weekStart">
                                                <label for="weekStart">Week Start Date</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-floating">
                                                <select class="form-select" id="weeklyBranchFilter">
                                                    <option value="all">All Branches</option>
                                                </select>
                                                <label for="weeklyBranchFilter">Branch</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="weeklyReportContent" class="mt-4">
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle"></i> Select a week start date and generate the report to view weekly performance metrics.
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="monthly" role="tabpanel">
                            <div class="report-card">
                                <div class="report-header">
                                    <div class="report-title">Monthly Performance Report</div>
                                    <div class="report-actions">
                                        <button class="btn btn-sm btn-outline-primary" onclick="generateMonthlyReport()">
                                            <i class="bi bi-arrow-clockwise"></i> Generate
                                        </button>
                                        <button class="btn btn-sm btn-outline-primary" onclick="exportReport('monthly')">
                                            <i class="bi bi-download"></i> Export
                                        </button>
                                    </div>
                                </div>
                                <div class="filter-section">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-floating">
                                                <input type="month" class="form-control" id="monthYear">
                                                <label for="monthYear">Select Month</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-floating">
                                                <select class="form-select" id="monthlyBranchFilter">
                                                    <option value="all">All Branches</option>
                                                </select>
                                                <label for="monthlyBranchFilter">Branch</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="monthlyReportContent" class="mt-4">
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle"></i> Select a month and generate the report to view monthly performance metrics.
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="branch" role="tabpanel">
                            <div class="report-card">
                                <div class="report-header">
                                    <div class="report-title">Branch Performance Report</div>
                                    <div class="report-actions">
                                        <button class="btn btn-sm btn-outline-primary" onclick="generateBranchReport()">
                                            <i class="bi bi-arrow-clockwise"></i> Generate
                                        </button>
                                        <button class="btn btn-sm btn-outline-primary" onclick="exportReport('branch')">
                                            <i class="bi bi-download"></i> Export
                                        </button>
                                    </div>
                                </div>
                                <div class="filter-section">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-floating">
                                                <select class="form-select" id="branchReportBranchFilter">
                                                    <option value="">Select Branch</option>
                                                </select>
                                                <label for="branchReportBranchFilter">Branch</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-floating">
                                                <select class="form-select" id="branchReportPeriodFilter">
                                                    <option value="month">Monthly</option>
                                                    <option value="quarter">Quarterly</option>
                                                    <option value="year">Yearly</option>
                                                </select>
                                                <label for="branchReportPeriodFilter">Period</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="branchReportContent" class="mt-4">
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle"></i> Select a branch and period to generate the branch performance report.
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="custom" role="tabpanel">
                            <div class="report-card">
                                <div class="report-header">
                                    <div class="report-title">Custom Report</div>
                                    <div class="report-actions">
                                        <button class="btn btn-sm btn-outline-primary" onclick="generateCustomReport()">
                                            <i class="bi bi-arrow-clockwise"></i> Generate
                                        </button>
                                        <button class="btn btn-sm btn-outline-primary" onclick="exportReport('custom')">
                                            <i class="bi bi-download"></i> Export
                                        </button>
                                    </div>
                                </div>
                                <div class="filter-section">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-floating">
                                                <input type="date" class="form-control" id="customStartDate">
                                                <label for="customStartDate">Start Date</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-floating">
                                                <input type="date" class="form-control" id="customEndDate">
                                                <label for="customEndDate">End Date</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-floating">
                                                <select class="form-select" id="customBranchFilter">
                                                    <option value="all">All Branches</option>
                                                </select>
                                                <label for="customBranchFilter">Branch</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-12">
                                            <div class="form-floating">
                                                <select class="form-select" id="customMetrics" multiple>
                                                    <option value="calls">Call Volume</option>
                                                    <option value="sales">Sales Performance</option>
                                                    <option value="fcr">First Call Resolution</option>
                                                    <option value="aht">Average Handle Time</option>
                                                    <option value="complaints">Complaints</option>
                                                    <option value="agent">Agent Performance</option>
                                                    <option value="branch">Branch Performance</option>
                                                </select>
                                                <label for="customMetrics">Select Metrics to Include</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="customReportContent" class="mt-4">
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle"></i> Select date range, branch, and metrics to generate a custom report.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <!-- Footer -->
    <footer class="footer mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>Crispy Chicken LLC Center Management System</h5>
                    <p>Comprehensive system for managing Crispy Chicken branches and call center operations</p>
                </div>
                <div class="col-md-3">
                    <h5>Quick Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-white">Dashboard</a></li>
                        <li><a href="#" class="text-white">Branches</a></li>
                        <li><a href="#" class="text-white">Reports</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h5>Technical Support</h5>
                    <p>For inquiries or technical issues, please contact the IT department</p>
                </div>
            </div>
            <hr class="bg-white">
            <div class="text-center">
                <p class="mb-0"> 2023 Crispy Chicken LLC. All rights reserved.</p>
            </div>
        </div>
    </footer>
    <!-- Modals remain unchanged -->
    <script>
        // Initialize data structures
        let branches = [
            {
                id: 1,
                name: "Crispy Chicken-Hamdan St",
                city: "Abu Dhabi",
                directions: "24.4958298421285, 54.37155779999593",
                area: "Hamdan Opposite Sun and San Sports",
                landline: "(02) 641 1194",
                googleSite: "https://g.co/kgs/TrxJBJV",
                rating: 4,
                managerName: "Mr. Mahmoud",
                managerNumber: "971 55 688 6650",
                emailAddress: "crispychickenhamdan@gmail.com",
                deliveryStatus: "Yes",
                onlineLink: "http://almarkaziya.crispychicken-uae.com/#_branch94929"
            },
            {
                id: 2,
                name: "Crispy chicken Shabiya 11",
                city: "Abu Dhabi",
                directions: "24.328366371847554, 54.535004577124376",
                area: "Mohamed Bin Zayed City - ME-11",
                landline: "(02) 554 9889",
                googleSite: "https://g.co/kgs/QQh8CXL",
                rating: 3.7,
                managerName: "Mr. Zakaria",
                managerNumber: "971 56 269 0688",
                emailAddress: "shabiha@crispychicken.rest",
                deliveryStatus: "Yes",
                onlineLink: "http://crispychicken-uae.com/#_branch94472"
            },
            {
                id: 3,
                name: "Crispy chicken khaldia",
                city: "Abu Dhabi",
                directions: "24.47955696172264, 54.353930808868604",
                area: "Khalidiya Tower - Al Khalidiya Street - opp. Grand Store",
                landline: "(02) 546 0900",
                googleSite: "https://g.co/kgs/Du9UqrY",
                rating: 3.9,
                managerName: "Mr. Adel",
                managerNumber: "971 56 949 4764",
                emailAddress: "crispychicken.khalidia@gmail.com",
                deliveryStatus: "Yes",
                onlineLink: "http://alkhalidiyah.crispychicken-uae.com/#_branch94938"
            },
            {
                id: 4,
                name: "Crispy chicken Elactra",
                city: "Abu Dhabi",
                directions: "",
                area: "Electra street opp LLH hospital",
                landline: "(02)8826902",
                googleSite: "",
                rating: 0,
                managerName: "Mr. RJ",
                managerNumber: "971 56 386 6859",
                emailAddress: "electra@crispychicken.rest",
                deliveryStatus: "No",
                onlineLink: "N/A"
            },
            {
                id: 5,
                name: "Crispy chicken Muroor",
                city: "Abu Dhabi",
                directions: "24.434503442604896, 54.43866580679551",
                area: "31 Muroor Rd - Al Sa'adah - Zone 1",
                landline: "(02) 563 3359",
                googleSite: "https://g.co/kgs/qS1e4Bi",
                rating: 4,
                managerName: "Mr. Tariq",
                managerNumber: "971 50 541 4641",
                emailAddress: "MOUROOR@CRISPYCHICKEN.REST",
                deliveryStatus: "Yes",
                onlineLink: "http://almuroorroad.crispychicken-uae.com/#_branch102831"
            },
            {
                id: 6,
                name: "Crispy chicken Al Barsha",
                city: "Dubai",
                directions: "25.11589564435004, 55.20455565397946",
                area: "Al Barsha 1",
                landline: "(04) 835 8195",
                googleSite: "https://g.co/kgs/6xh7DNw",
                rating: 4.4,
                managerName: "Mr. Mahmed",
                managerNumber: "971569659524",
                emailAddress: "barsha@crispychicken.rest",
                deliveryStatus: "Yes",
                onlineLink: "http://albarsha.crispychicken-uae.com/#_branch124062"
            },
            {
                id: 7,
                name: "Crispy chicken Al Satwa",
                city: "Dubai",
                directions: "25.232522002773372, 55.2694237276173",
                area: "Satwa street Dubai",
                landline: "(04)3265878",
                googleSite: "https://maps.app.goo.gl/XnyngSy4wgtSLRfc8",
                rating: 4.5,
                managerName: "Mr. Musab",
                managerNumber: "971 56 797 0685",
                emailAddress: "satwa@crispychicken.rest",
                deliveryStatus: "Yes",
                onlineLink: "http://satwa.crispychicken-uae.com/#_branch173500"
            },
            {
                id: 8,
                name: "Crispy chicken Al Regga",
                city: "Dubai",
                directions: "new brunch",
                area: "AReega area",
                landline: "",
                googleSite: "https://maps.app.goo.gl/rfpWM5nrFTkxZMiX6?g_st=iw",
                rating: 5,
                managerName: "Mr. Zaid",
                managerNumber: "971 56 740 5572",
                emailAddress: "",
                deliveryStatus: "",
                onlineLink: ""
            }
        ];
        let agents = {};
        let dailyLogs = [];
        let complaints = [];
        let tasks = [];
        let goals = {
            daily_sales: 1000,
            weekly_sales: 5000,
            monthly_sales: 20000,
            fcr_target: 85,
            aht_target: 4.0
        };
        let currentTaskId = null;
        let currentComplaintId = null;
        let currentBranchId = null;
        let viewMode = 'cards'; // cards, table, map
        let map = null;
        let markers = [];
        
        // Load data from localStorage
        function loadData() {
            const savedBranches = localStorage.getItem('crispyBranches');
            const savedAgents = localStorage.getItem('crispyAgents');
            const savedLogs = localStorage.getItem('crispyDailyLogs');
            const savedComplaints = localStorage.getItem('crispyComplaints');
            const savedTasks = localStorage.getItem('crispyTasks');
            const savedGoals = localStorage.getItem('crispyGoals');
            
            if (savedBranches) branches = JSON.parse(savedBranches);
            if (savedAgents) agents = JSON.parse(savedAgents);
            if (savedLogs) dailyLogs = JSON.parse(savedLogs);
            if (savedComplaints) complaints = JSON.parse(savedComplaints);
            if (savedTasks) tasks = JSON.parse(savedTasks);
            if (savedGoals) goals = JSON.parse(savedGoals);
            
            updateDashboard();
            updateBranchesList();
            updateTasksList();
            updateAgentsTable();
            updateCallsTable();
            updateComplaintsTable();
            updateAgentSelects();
            updateBranchSelects();
            initializeCharts();
        }
        
        // Save data to localStorage
        function saveData() {
            localStorage.setItem('crispyBranches', JSON.stringify(branches));
            localStorage.setItem('crispyAgents', JSON.stringify(agents));
            localStorage.setItem('crispyDailyLogs', JSON.stringify(dailyLogs));
            localStorage.setItem('crispyComplaints', JSON.stringify(complaints));
            localStorage.setItem('crispyTasks', JSON.stringify(tasks));
            localStorage.setItem('crispyGoals', JSON.stringify(goals));
        }
        
        // Show section
        function showSection(sectionId) {
            // Hide all sections
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(sectionId).style.display = 'block';
            
            // Update nav links
            const navLinks = document.querySelectorAll('.navbar-nav .nav-link, .sidebar .nav-link');
            navLinks.forEach(link => {
                link.classList.remove('active');
            });
            
            // Find the link that matches the section and make it active
            const matchingLinks = document.querySelectorAll(`a[onclick="showSection('${sectionId}')"]`);
            matchingLinks.forEach(link => {
                link.classList.add('active');
            });
            
            // Initialize map if branches section is shown
            if (sectionId === 'branches' && viewMode === 'map') {
                setTimeout(initMap, 100);
            }
        }
        
        // Initialize charts
        function initializeCharts() {
            // Sales Chart
            const salesCtx = document.getElementById('salesChart').getContext('2d');
            
            // Get last 7 days
            const days = [];
            const sales = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                days.push(date.toLocaleDateString('en', { weekday: 'short' }));
                
                const daySales = dailyLogs
                    .filter(log => log.date === dateStr)
                    .reduce((sum, log) => sum + parseFloat(log.sale_amount || 0), 0);
                sales.push(daySales);
            }
            
            new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'Sales (AED)',
                        data: sales,
                        backgroundColor: 'rgba(228, 0, 43, 0.2)',
                        borderColor: 'rgba(228, 0, 43, 1)',
                        borderWidth: 2,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Branch Distribution Chart
            const branchDistCtx = document.getElementById('branchDistributionChart').getContext('2d');
            
            // Count branches by city
            const cityCounts = {};
            branches.forEach(branch => {
                cityCounts[branch.city] = (cityCounts[branch.city] || 0) + 1;
            });
            
            new Chart(branchDistCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(cityCounts),
                    datasets: [{
                        data: Object.values(cityCounts),
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
            
            // Top Branches Chart
            const topBranchesCtx = document.getElementById('topBranchesChart').getContext('2d');
            
            // Get sales by branch
            const branchSales = {};
            branches.forEach(branch => {
                branchSales[branch.name] = 0;
            });
            
            dailyLogs.forEach(log => {
                if (log.branch_id && branchSales[branches.find(b => b.id === log.branch_id)?.name] !== undefined) {
                    branchSales[branches.find(b => b.id === log.branch_id).name] += parseFloat(log.sale_amount || 0);
                }
            });
            
            // Sort by sales and get top 5
            const sortedBranches = Object.entries(branchSales)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            new Chart(topBranchesCtx, {
                type: 'bar',
                data: {
                    labels: sortedBranches.map(([name, _]) => name),
                    datasets: [{
                        label: 'Sales (AED)',
                        data: sortedBranches.map(([_, sales]) => sales),
                        backgroundColor: 'rgba(228, 0, 43, 0.7)',
                        borderColor: 'rgba(228, 0, 43, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Call Distribution Chart
            const callDistCtx = document.getElementById('callDistributionChart').getContext('2d');
            
            // Count calls by type
            const callTypes = {
                'Order': dailyLogs.filter(log => log.call_type === 'order').length,
                'Inquiry': dailyLogs.filter(log => log.call_type === 'inquiry').length,
                'Complaint': dailyLogs.filter(log => log.call_type === 'complaint').length
            };
            
            new Chart(callDistCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys(callTypes),
                    datasets: [{
                        data: Object.values(callTypes),
                        backgroundColor: [
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(255, 99, 132, 0.7)'
                        ],
                        borderColor: [
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(255, 99, 132, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
        
        // Update dashboard
        function updateDashboard() {
            // Update stats
            document.getElementById('totalBranches').textContent = branches.length;
            document.getElementById('totalAgents').textContent = Object.keys(agents).length;
            
            // Today's calls
            const today = new Date().toISOString().split('T')[0];
            const todayCalls = dailyLogs.filter(log => log.date === today);
            document.getElementById('todayCalls').textContent = todayCalls.length;
            
            // Today's sales
            const todaySales = todayCalls.reduce((sum, log) => sum + parseFloat(log.sale_amount || 0), 0);
            document.getElementById('todaySales').textContent = todaySales.toFixed(2);
        }
        
        // Update branches list
        function updateBranchesList() {
            const branchesCardsView = document.getElementById('branchesCardsView');
            const branchesTableView = document.getElementById('branchesTableView');
            const branchesMapView = document.getElementById('branchesMapView');
            
            // Clear existing content
            branchesCardsView.innerHTML = '';
            
            // Apply filters
            const cityFilter = document.getElementById('branchCityFilter').value;
            const ratingFilter = document.getElementById('branchRatingFilter').value;
            const statusFilter = document.getElementById('branchStatusFilter').value;
            
            let filteredBranches = [...branches];
            
            if (cityFilter !== 'all') {
                filteredBranches = filteredBranches.filter(branch => branch.city === cityFilter);
            }
            
            if (ratingFilter !== 'all') {
                filteredBranches = filteredBranches.filter(branch => {
                    const rating = parseFloat(branch.rating);
                    return rating >= parseFloat(ratingFilter) && rating < parseFloat(ratingFilter) + 1;
                });
            }
            
            if (statusFilter !== 'all') {
                filteredBranches = filteredBranches.filter(branch => 
                    branch.deliveryStatus === (statusFilter === 'open' ? 'Yes' : 'No')
                );
            }
            
            // Update count
            document.getElementById('branchCount').textContent = `${filteredBranches.length} branches`;
            document.getElementById('branchMapCount').textContent = `${filteredBranches.length} branches`;
            
            if (filteredBranches.length === 0) {
                branchesCardsView.innerHTML = '<div class="col-12 text-center py-5">No branches found</div>';
                return;
            }
            
            // Create branch cards
            filteredBranches.forEach(branch => {
                const branchCard = document.createElement('div');
                branchCard.className = 'col-md-4 mb-4';
                branchCard.innerHTML = `
                    <div class="branch-card">
                        <div class="branch-header">
                            <div class="branch-name">${branch.name}</div>
                            <div class="branch-rating">
                                ${generateStarRating(branch.rating)}
                            </div>
                        </div>
                        <div class="branch-info">
                            <div class="branch-info-item">
                                <div class="branch-info-label">City:</div>
                                <div class="branch-info-value">${branch.city}</div>
                            </div>
                            <div class="branch-info-item">
                                <div class="branch-info-label">Area:</div>
                                <div class="branch-info-value">${branch.area}</div>
                            </div>
                            <div class="branch-info-item">
                                <div class="branch-info-label">Manager:</div>
                                <div class="branch-info-value">${branch.managerName}</div>
                            </div>
                            <div class="branch-info-item">
                                <div class="branch-info-label">Contact:</div>
                                <div class="branch-info-value">${branch.landline}</div>
                            </div>
                        </div>
                        <div class="branch-actions">
                            <button class="btn btn-sm btn-outline-primary" onclick="viewBranch(${branch.id})">
                                <i class="bi bi-eye-fill"></i> View
                            </button>
                            <button class="btn btn-sm btn-outline-primary" onclick="editBranch(${branch.id})">
                                <i class="bi bi-pencil-fill"></i> Edit
                            </button>
                            ${branch.googleSite ? `<a href="${branch.googleSite}" target="_blank" class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-geo-alt-fill"></i> Map
                            </a>` : ''}
                            ${branch.onlineLink && branch.onlineLink !== 'N/A' ? `<a href="${branch.onlineLink}" target="_blank" class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-globe"></i> Online
                            </a>` : ''}
                        </div>
                        <div class="mt-2">
                            <span class="branch-status ${branch.deliveryStatus === 'Yes' ? 'status-open' : 'status-closed'}">
                                ${branch.deliveryStatus === 'Yes' ? 'Delivery Available' : 'No Delivery'}
                            </span>
                        </div>
                    </div>
                `;
                branchesCardsView.appendChild(branchCard);
            });
            
            // Update table view
            updateBranchesTable(filteredBranches);
            
            // Update map view
            if (viewMode === 'map') {
                updateBranchesMap(filteredBranches);
            }
        }
        
        // Update branches table
        function updateBranchesTable(filteredBranches) {
            const branchesTable = document.getElementById('branchesTable');
            branchesTable.innerHTML = '';
            
            if (filteredBranches.length === 0) {
                branchesTable.innerHTML = '<tr><td colspan="8" class="text-center">No branches found</td></tr>';
                return;
            }
            
            filteredBranches.forEach(branch => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${branch.name}</td>
                    <td>${branch.city}</td>
                    <td>${branch.area}</td>
                    <td>${generateStarRating(branch.rating)}</td>
                    <td>${branch.managerName}</td>
                    <td>${branch.landline}</td>
                    <td>${branch.deliveryStatus === 'Yes' ? 
                        '<span class="badge bg-success">Yes</span>' : 
                        '<span class="badge bg-danger">No</span>'}
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary" onclick="viewBranch(${branch.id})">
                                <i class="bi bi-eye-fill"></i>
                            </button>
                            <button class="btn btn-outline-primary" onclick="editBranch(${branch.id})">
                                <i class="bi bi-pencil-fill"></i>
                            </button>
                        </div>
                    </td>
                `;
                branchesTable.appendChild(row);
            });
        }
        
        // Generate star rating HTML
        function generateStarRating(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
            
            let starsHtml = '';
            
            // Full stars
            for (let i = 0; i < fullStars; i++) {
                starsHtml += '<i class="bi bi-star-fill"></i>';
            }
            
            // Half star
            if (hasHalfStar) {
                starsHtml += '<i class="bi bi-star-half"></i>';
            }
            
            // Empty stars
            for (let i = 0; i < emptyStars; i++) {
                starsHtml += '<i class="bi bi-star"></i>';
            }
            
            return starsHtml;
        }
        
        // Initialize map
        function initMap() {
            // Clear existing markers
            markers.forEach(marker => {
                map.removeLayer(marker);
            });
            markers = [];
            
            // Create map
            if (map) {
                map.remove();
            }
            
            map = L.map('map').setView([24.4539, 54.3773], 10);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            // Add markers for each branch
            branches.forEach(branch => {
                if (branch.directions) {
                    const coords = branch.directions.split(', ');
                    const lat = parseFloat(coords[0]);
                    const lng = parseFloat(coords[1]);
                    
                    if (!isNaN(lat) && !isNaN(lng)) {
                        const marker = L.marker([lat, lng]).addTo(map);
                        
                        // Create popup content
                        const popupContent = `
                            <div>
                                <h6>${branch.name}</h6>
                                <p>${branch.area}</p>
                                <p>${branch.city}</p>
                                <p><strong>Manager:</strong> ${branch.managerName}</p>
                                <p><strong>Contact:</strong> ${branch.landline}</p>
                                <div class="mt-2">
                                    <button class="btn btn-sm btn-primary" onclick="viewBranch(${branch.id})">View Details</button>
                                </div>
                            </div>
                        `;
                        
                        marker.bindPopup(popupContent);
                        markers.push(marker);
                    }
                }
            });
            
            // Fit map to show all markers
            if (markers.length > 0) {
                const group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }
        
        // Update branches map
        function updateBranchesMap(filteredBranches) {
            if (viewMode === 'map' && map) {
                // Clear existing markers
                markers.forEach(marker => {
                    map.removeLayer(marker);
                });
                markers = [];
                
                // Add markers for filtered branches
                filteredBranches.forEach(branch => {
                    if (branch.directions) {
                        const coords = branch.directions.split(', ');
                        const lat = parseFloat(coords[0]);
                        const lng = parseFloat(coords[1]);
                        
                        if (!isNaN(lat) && !isNaN(lng)) {
                            const marker = L.marker([lat, lng]).addTo(map);
                            
                            // Create popup content
                            const popupContent = `
                                <div>
                                    <h6>${branch.name}</h6>
                                    <p>${branch.area}</p>
                                    <p>${branch.city}</p>
                                    <p><strong>Manager:</strong> ${branch.managerName}</p>
                                    <p><strong>Contact:</strong> ${branch.landline}</p>
                                    <div class="mt-2">
                                        <button class="btn btn-sm btn-primary" onclick="viewBranch(${branch.id})">View Details</button>
                                    </div>
                                </div>
                            `;
                            
                            marker.bindPopup(popupContent);
                            markers.push(marker);
                        }
                    }
                });
                
                // Fit map to show all markers
                if (markers.length > 0) {
                    const group = new L.featureGroup(markers);
                    map.fitBounds(group.getBounds().pad(0.1));
                }
            }
        }
        
        // Set view mode
        function setViewMode(mode) {
            viewMode = mode;
            
            // Update button states
            document.querySelectorAll('#branches .btn-group .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Show/hide views
            document.getElementById('branchesCardsView').style.display = mode === 'cards' ? 'flex' : 'none';
            document.getElementById('branchesTableView').style.display = mode === 'table' ? 'block' : 'none';
            document.getElementById('branchesMapView').style.display = mode === 'map' ? 'block' : 'none';
            
            // Initialize map if map view
            if (mode === 'map') {
                setTimeout(initMap, 100);
            }
        }
        
        // View branch details
        function viewBranch(branchId) {
            const branch = branches.find(b => b.id === branchId);
            if (branch) {
                currentBranchId = branchId;
                
                const branchDetails = document.getElementById('branchDetails');
                branchDetails.innerHTML = `
                    <div class="row">
                        <div class="col-md-6">
                            <h5>${branch.name}</h5>
                            <div class="mb-3">
                                ${generateStarRating(branch.rating)}
                            </div>
                            <table class="table table-sm">
                                <tr>
                                    <td class="fw-bold">City:</td>
                                    <td>${branch.city}</td>
                                </tr>
                                <tr>
                                    <td class="fw-bold">Area:</td>
                                    <td>${branch.area}</td>
                                </tr>
                                <tr>
                                    <td class="fw-bold">Landline:</td>
                                    <td>${branch.landline}</td>
                                </tr>
                                <tr>
                                    <td class="fw-bold">Manager:</td>
                                    <td>${branch.managerName}</td>
                                </tr>
                                <tr>
                                    <td class="fw-bold">Manager Number:</td>
                                    <td>${branch.managerNumber}</td>
                                </tr>
                                <tr>
                                    <td class="fw-bold">Email:</td>
                                    <td>${branch.emailAddress}</td>
                                </tr>
                                <tr>
                                    <td class="fw-bold">Delivery Status:</td>
                                    <td>${branch.deliveryStatus}</td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            ${branch.googleSite ? `
                                <div class="mb-3">
                                    <h6>Google Maps</h6>
                                    <a href="${branch.googleSite}" target="_blank" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-geo-alt-fill"></i> View on Google Maps
                                    </a>
                                </div>
                            ` : ''}
                            ${branch.onlineLink && branch.onlineLink !== 'N/A' ? `
                                <div class="mb-3">
                                    <h6>Online Ordering</h6>
                                    <a href="${branch.onlineLink}" target="_blank" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-globe"></i> Order Online
                                    </a>
                                </div>
                            ` : ''}
                            ${branch.directions ? `
                                <div class="mb-3">
                                    <h6>Directions</h6>
                                    <div class="form-control">${branch.directions}</div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                
                const modal = new bootstrap.Modal(document.getElementById('viewBranchModal'));
                modal.show();
            }
        }
        
        // Edit branch
        function editBranch(branchId) {
            const branch = branches.find(b => b.id === branchId);
            if (branch) {
                // Pre-fill the form with branch data
                document.getElementById('branchName').value = branch.name;
                document.getElementById('branchCity').value = branch.city;
                document.getElementById('branchArea').value = branch.area;
                document.getElementById('branchLandline').value = branch.landline;
                document.getElementById('branchGoogleSite').value = branch.googleSite;
                document.getElementById('branchRating').value = branch.rating;
                document.getElementById('branchManagerName').value = branch.managerName;
                document.getElementById('branchManagerNumber').value = branch.managerNumber;
                document.getElementById('branchManagerEmail').value = branch.emailAddress;
                document.getElementById('branchDeliveryStatus').value = branch.deliveryStatus;
                document.getElementById('branchOnlineLink').value = branch.onlineLink;
                document.getElementById('branchDirections').value = branch.directions;
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('addBranchModal'));
                modal.show();
                
                // Change the modal title
                document.querySelector('#addBranchModal .modal-title').textContent = 'Edit Branch';
                
                // Change the save button to update
                const saveBtn = document.querySelector('#addBranchModal .btn-primary');
                saveBtn.textContent = 'Update Branch';
                saveBtn.onclick = () => updateBranch(branchId);
            }
        }
        
        // Update branch
        function updateBranch(branchId) {
            const branchIndex = branches.findIndex(b => b.id === branchId);
            if (branchIndex !== -1) {
                // Update branch data
                branches[branchIndex] = {
                    id: branchId,
                    name: document.getElementById('branchName').value,
                    city: document.getElementById('branchCity').value,
                    directions: document.getElementById('branchDirections').value,
                    area: document.getElementById('branchArea').value,
                    landline: document.getElementById('branchLandline').value,
                    googleSite: document.getElementById('branchGoogleSite').value,
                    rating: parseFloat(document.getElementById('branchRating').value),
                    managerName: document.getElementById('branchManagerName').value,
                    managerNumber: document.getElementById('branchManagerNumber').value,
                    emailAddress: document.getElementById('branchManagerEmail').value,
                    deliveryStatus: document.getElementById('branchDeliveryStatus').value,
                    onlineLink: document.getElementById('branchOnlineLink').value
                };
                
                // Save data
                saveData();
                
                // Update UI
                updateBranchesList();
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('addBranchModal'));
                modal.hide();
                
                // Show success message
                showToast('Branch updated successfully');
            }
        }
        
        // Show add branch modal
        function showAddBranchModal() {
            // Reset form
            document.getElementById('addBranchForm').reset();
            
            // Change the modal title
            document.querySelector('#addBranchModal .modal-title').textContent = 'Add New Branch';
            
            // Change the save button to add
            const saveBtn = document.querySelector('#addBranchModal .btn-primary');
            saveBtn.textContent = 'Save Branch';
            saveBtn.onclick = saveBranch;
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('addBranchModal'));
            modal.show();
        }
        
        // Save branch
        function saveBranch() {
            const newBranch = {
                id: Date.now(), // Generate a unique ID
                name: document.getElementById('branchName').value,
                city: document.getElementById('branchCity').value,
                directions: document.getElementById('branchDirections').value,
                area: document.getElementById('branchArea').value,
                landline: document.getElementById('branchLandline').value,
                googleSite: document.getElementById('branchGoogleSite').value,
                rating: parseFloat(document.getElementById('branchRating').value),
                managerName: document.getElementById('branchManagerName').value,
                managerNumber: document.getElementById('branchManagerNumber').value,
                emailAddress: document.getElementById('branchManagerEmail').value,
                deliveryStatus: document.getElementById('branchDeliveryStatus').value,
                onlineLink: document.getElementById('branchOnlineLink').value
            };
            
            // Add to branches array
            branches.push(newBranch);
            
            // Save data
            saveData();
            
            // Update UI
            updateBranchesList();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addBranchModal'));
            modal.hide();
            
            // Show success message
            showToast('Branch added successfully');
        }
        
        // Update tasks list
        function updateTasksList(filter = 'all') {
            const tasksTable = document.getElementById('tasksTable');
            tasksTable.innerHTML = '';
            
            // Filter tasks
            let filteredTasks = tasks;
            if (filter !== 'all') {
                filteredTasks = tasks.filter(task => task.status === filter);
            }
            
            // Apply additional filters
            const statusFilter = document.getElementById('taskStatusFilter').value;
            const priorityFilter = document.getElementById('taskPriorityFilter').value;
            const categoryFilter = document.getElementById('taskCategoryFilter').value;
            const searchFilter = document.getElementById('taskSearchFilter').value.toLowerCase();
            
            if (statusFilter !== 'all') {
                filteredTasks = filteredTasks.filter(task => task.status === statusFilter);
            }
            
            if (priorityFilter !== 'all') {
                filteredTasks = filteredTasks.filter(task => task.priority === priorityFilter);
            }
            
            if (categoryFilter !== 'all') {
                filteredTasks = filteredTasks.filter(task => task.category === categoryFilter);
            }
            
            if (searchFilter) {
                filteredTasks = filteredTasks.filter(task => 
                    task.title.toLowerCase().includes(searchFilter) || 
                    task.description.toLowerCase().includes(searchFilter)
                );
            }
            
            // Update count
            document.getElementById('taskCount').textContent = `${filteredTasks.length} tasks`;
            
            if (filteredTasks.length === 0) {
                tasksTable.innerHTML = '<tr><td colspan="7" class="text-center">No tasks found</td></tr>';
                return;
            }
            
            // Sort by due date
            filteredTasks.sort((a, b) => new Date(a.due_date) - new Date(b.due_date));
            
            filteredTasks.forEach(task => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="agent-status ${getTaskStatusClass(task.status)}"></div>
                            <div>
                                <div>${task.title}</div>
                                <small class="text-muted">${task.description.substring(0, 50)}${task.description.length > 50 ? '...' : ''}</small>
                            </div>
                        </div>
                    </td>
                    <td>${formatTaskCategory(task.category)}</td>
                    <td><span class="badge ${getTaskPriorityBadgeClass(task.priority)}">${formatTaskPriority(task.priority)}</span></td>
                    <td>${agents[task.assigned_to]?.name || 'Unassigned'}</td>
                    <td>${formatDate(task.due_date)}</td>
                    <td><span class="badge ${getTaskStatusBadgeClass(task.status)}">${formatTaskStatus(task.status)}</span></td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary" onclick="viewTask('${task.id}')">
                                <i class="bi bi-eye-fill"></i>
                            </button>
                            <button class="btn btn-outline-success" onclick="completeTask('${task.id}')">
                                <i class="bi bi-check-circle-fill"></i>
                            </button>
                        </div>
                    </td>
                `;
                tasksTable.appendChild(row);
            });
        }
        
        // Helper functions for task status and priority
        function getTaskStatusClass(status) {
            const classes = {
                'pending': 'status-break',
                'in-progress': 'status-online',
                'completed': 'status-offline'
            };
            return classes[status] || 'status-offline';
        }
        
        function getTaskStatusBadgeClass(status) {
            const classes = {
                'pending': 'bg-warning',
                'in-progress': 'bg-info',
                'completed': 'bg-success'
            };
            return classes[status] || 'bg-secondary';
        }
        
        function getTaskPriorityBadgeClass(priority) {
            const classes = {
                'high': 'bg-danger',
                'medium': 'bg-warning',
                'low': 'bg-success'
            };
            return classes[priority] || 'bg-secondary';
        }
        
        function formatTaskCategory(category) {
            const categories = {
                'training': 'Training',
                'meeting': 'Meeting',
                'follow-up': 'Follow-up',
                'report': 'Report',
                'maintenance': 'Maintenance'
            };
            return categories[category] || category;
        }
        
        function formatTaskPriority(priority) {
            const priorities = {
                'high': 'High',
                'medium': 'Medium',
                'low': 'Low'
            };
            return priorities[priority] || priority;
        }
        
        function formatTaskStatus(status) {
            const statuses = {
                'pending': 'Pending',
                'in-progress': 'In Progress',
                'completed': 'Completed'
            };
            return statuses[status] || status;
        }
        
        // View task details
        function viewTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                currentTaskId = taskId;
                
                const taskDetails = document.getElementById('taskDetails');
                taskDetails.innerHTML = `
                    <div class="mb-3">
                        <h5>${task.title}</h5>
                        <span class="badge ${getTaskPriorityBadgeClass(task.priority)}">${formatTaskPriority(task.priority)}</span>
                        <span class="badge ${getTaskStatusBadgeClass(task.status)}">${formatTaskStatus(task.status)}</span>
                    </div>
                    <div class="mb-2">
                        <strong>Category:</strong> ${formatTaskCategory(task.category)}
                    </div>
                    <div class="mb-2">
                        <strong>Due Date:</strong> ${formatDate(task.due_date)}
                    </div>
                    <div class="mb-2">
                        <strong>Assigned To:</strong> ${agents[task.assigned_to]?.name || 'Unassigned'}
                    </div>
                    <div class="mb-2">
                        <strong>Description:</strong> ${task.description}
                    </div>
                    <div class="mb-2">
                        <strong>Created:</strong> ${formatDate(task.created_at)}
                    </div>
                `;
                
                // Update button based on status
                const updateBtn = document.getElementById('updateTaskBtn');
                if (task.status === 'pending') {
                    updateBtn.textContent = 'Mark as In Progress';
                    updateBtn.onclick = () => updateTaskStatus('in-progress');
                } else if (task.status === 'in-progress') {
                    updateBtn.textContent = 'Mark as Completed';
                    updateBtn.onclick = () => updateTaskStatus('completed');
                } else {
                    updateBtn.style.display = 'none';
                }
                
                const modal = new bootstrap.Modal(document.getElementById('viewTaskModal'));
                modal.show();
            }
        }
        
        // Update task status
        function updateTaskStatus(newStatus) {
            const taskIndex = tasks.findIndex(t => t.id === currentTaskId);
            if (taskIndex !== -1) {
                tasks[taskIndex].status = newStatus;
                saveData();
                updateTasksList();
                updateDashboard();
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('viewTaskModal'));
                modal.hide();
                
                // Show success message
                showToast(`Task status updated to "${formatTaskStatus(newStatus)}"`);
            }
        }
        
        // Complete task
        function completeTask(taskId) {
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            if (taskIndex !== -1) {
                tasks[taskIndex].status = 'completed';
                saveData();
                updateTasksList();
                updateDashboard();
                showToast('Task marked as completed');
            }
        }
        
        // Filter tasks
        function filterTasks() {
            updateTasksList();
        }
        
        // Update agents table
        function updateAgentsTable() {
            const agentsTable = document.getElementById('agentsTable');
            agentsTable.innerHTML = '';
            
            // Apply filters
            const searchFilter = document.getElementById('agentSearchFilter').value.toLowerCase();
            const positionFilter = document.getElementById('agentPositionFilter').value;
            const statusFilter = document.getElementById('agentStatusFilter').value;
            
            let filteredAgents = Object.entries(agents);
            
            if (searchFilter) {
                filteredAgents = filteredAgents.filter(([_, agent]) => 
                    agent.name.toLowerCase().includes(searchFilter) || 
                    agent.position.toLowerCase().includes(searchFilter) ||
                    agent.contact.toLowerCase().includes(searchFilter)
                );
            }
            
            if (positionFilter !== 'all') {
                filteredAgents = filteredAgents.filter(([_, agent]) => agent.position === positionFilter);
            }
            
            if (statusFilter !== 'all') {
                const isTrained = statusFilter === 'trained';
                filteredAgents = filteredAgents.filter(([_, agent]) => agent.training_completed === isTrained);
            }
            
            // Update count
            document.getElementById('agentCount').textContent = `${filteredAgents.length} agents`;
            
            if (filteredAgents.length === 0) {
                agentsTable.innerHTML = '<tr><td colspan="7" class="text-center">No agents found</td></tr>';
                return;
            }
            
            filteredAgents.forEach(([agentId, agent]) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${agentId}</td>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="agent-status ${agent.training_completed ? 'status-online' : 'status-offline'}"></div>
                            <div>
                                <div>${agent.name}</div>
                                <small class="text-muted">${agent.email || ''}</small>
                            </div>
                        </div>
                    </td>
                    <td>${agent.position}</td>
                    <td>${agent.contact}</td>
                    <td>${agent.training_completed ? 
                        '<span class="badge bg-success">Trained</span>' : 
                        '<span class="badge bg-warning">Not Trained</span>'}
                    </td>
                    <td>
                        <div>
                            <div>Calls: ${agent.performance.total_calls}</div>
                            <div>Sales: AED ${agent.performance.sales.toFixed(2)}</div>
                            <div class="performance-indicator ${getPerformanceClass(agent)}"></div>
                        </div>
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary" onclick="viewAgent('${agentId}')">
                                <i class="bi bi-eye-fill"></i>
                            </button>
                            <button class="btn btn-outline-success" onclick="trainAgent('${agentId}')">
                                <i class="bi bi-mortarboard-fill"></i>
                            </button>
                        </div>
                    </td>
                `;
                agentsTable.appendChild(row);
            });
        }
        
        // Get performance class based on agent performance
        function getPerformanceClass(agent) {
            const salesPerCall = agent.performance.total_calls > 0 ? 
                agent.performance.sales / agent.performance.total_calls : 0;
            
            if (salesPerCall > 20) return 'performance-high';
            if (salesPerCall > 10) return 'performance-medium';
            return 'performance-low';
        }
        
        // View agent details
        function viewAgent(agentId) {
            const agent = agents[agentId];
            if (agent) {
                alert(`Agent Details:\n\nID: ${agentId}\nName: ${agent.name}\nPosition: ${agent.position}\nContact: ${agent.contact}\nEmail: ${agent.email || 'N/A'}\nPhone: ${agent.phone || 'N/A'}\nTraining: ${agent.training_completed ? 'Completed' : 'Not Completed'}\nBranch: ${agent.branch_id ? branches.find(b => b.id === agent.branch_id)?.name || 'N/A' : 'N/A'}\n\nPerformance:\nTotal Calls: ${agent.performance.total_calls}\nTotal Sales: AED ${agent.performance.sales.toFixed(2)}\nComplaints: ${agent.performance.complaints}\nUpsells: ${agent.performance.upsells}`);
            }
        }
        
        // Train agent
        function trainAgent(agentId) {
            if (agents[agentId]) {
                agents[agentId].training_completed = true;
                saveData();
                updateAgentsTable();
                showToast(`Agent ${agents[agentId].name} has been marked as trained`);
            }
        }
        
        // Filter agents
        function filterAgents() {
            updateAgentsTable();
        }
        
        // Update calls table
        function updateCallsTable() {
            const callsTable = document.getElementById('callsTable');
            callsTable.innerHTML = '';
            
            // Apply filters
            const dateFilter = document.getElementById('callDateFilter').value;
            const typeFilter = document.getElementById('callTypeFilter').value;
            const agentFilter = document.getElementById('callAgentFilter').value;
            const branchFilter = document.getElementById('callBranchFilter').value;
            const outcomeFilter = document.getElementById('callOutcomeFilter').value;
            
            let filteredCalls = [...dailyLogs];
            
            if (dateFilter) {
                filteredCalls = filteredCalls.filter(log => log.date === dateFilter);
            }
            
            if (typeFilter !== 'all') {
                filteredCalls = filteredCalls.filter(log => log.call_type === typeFilter);
            }
            
            if (agentFilter !== 'all') {
                filteredCalls = filteredCalls.filter(log => log.agent_id === agentFilter);
            }
            
            if (branchFilter !== 'all') {
                filteredCalls = filteredCalls.filter(log => log.branch_id === parseInt(branchFilter));
            }
            
            if (outcomeFilter !== 'all') {
                filteredCalls = filteredCalls.filter(log => log.outcome === outcomeFilter);
            }
            
            // Update count
            document.getElementById('callCount').textContent = `${filteredCalls.length} calls`;
            
            if (filteredCalls.length === 0) {
                callsTable.innerHTML = '<tr><td colspan="7" class="text-center">No calls found</td></tr>';
                return;
            }
            
            // Sort by date (newest first)
            filteredCalls.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            filteredCalls.forEach(log => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(log.date)}</td>
                    <td>${agents[log.agent_id]?.name || 'Unknown'}</td>
                    <td>${branches.find(b => b.id === log.branch_id)?.name || 'Unknown'}</td>
                    <td>${formatCallType(log.call_type)}</td>
                    <td>${log.duration}</td>
                    <td>${formatCallOutcome(log.outcome)}</td>
                    <td>AED ${parseFloat(log.sale_amount || 0).toFixed(2)}</td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary" onclick="viewCall('${log.id}')">
                                <i class="bi bi-eye-fill"></i>
                            </button>
                        </div>
                    </td>
                `;
                callsTable.appendChild(row);
            });
        }
        
        // Helper functions for call type and outcome
        function formatCallType(type) {
            const types = {
                'order': 'Order',
                'inquiry': 'Inquiry',
                'complaint': 'Complaint'
            };
            return types[type] || type;
        }
        
        function formatCallOutcome(outcome) {
            const outcomes = {
                'order_placed': 'Order Placed',
                'resolved': 'Resolved',
                'escalated': 'Escalated'
            };
            return outcomes[outcome] || outcome;
        }
        
        // View call details
        function viewCall(callId) {
            const call = dailyLogs.find(log => log.id === callId);
            if (call) {
                alert(`Call Details:\n\nDate: ${formatDate(call.date)}\nAgent: ${agents[call.agent_id]?.name || 'Unknown'}\nBranch: ${branches.find(b => b.id === call.branch_id)?.name || 'Unknown'}\nType: ${formatCallType(call.call_type)}\nDuration: ${call.duration} minutes\nOutcome: ${formatCallOutcome(call.outcome)}\nSale Amount: AED ${parseFloat(call.sale_amount || 0).toFixed(2)}\nCustomer ID: ${call.customer_id || 'N/A'}\nNotes: ${call.notes || 'N/A'}`);
            }
        }
        
        // Filter calls
        function filterCalls() {
            updateCallsTable();
        }
        
        // Update complaints table
        function updateComplaintsTable() {
            const complaintsTable = document.getElementById('complaintsTable');
            complaintsTable.innerHTML = '';
            
            // Apply filters
            const dateFilter = document.getElementById('complaintDateFilter').value;
            const typeFilter = document.getElementById('complaintTypeFilter').value;
            const statusFilter = document.getElementById('complaintStatusFilter').value;
            const agentFilter = document.getElementById('complaintAgentFilter').value;
            const branchFilter = document.getElementById('complaintBranchFilter').value;
            
            let filteredComplaints = [...complaints];
            
            if (dateFilter) {
                filteredComplaints = filteredComplaints.filter(c => c.date === dateFilter);
            }
            
            if (typeFilter !== 'all') {
                filteredComplaints = filteredComplaints.filter(c => c.type === typeFilter);
            }
            
            if (statusFilter !== 'all') {
                filteredComplaints = filteredComplaints.filter(c => c.resolution_status === statusFilter);
            }
            
            if (agentFilter !== 'all') {
                filteredComplaints = filteredComplaints.filter(c => c.agent_id === agentFilter);
            }
            
            if (branchFilter !== 'all') {
                filteredComplaints = filteredComplaints.filter(c => c.branch_id === parseInt(branchFilter));
            }
            
            // Update count
            document.getElementById('complaintCount').textContent = `${filteredComplaints.length} complaints`;
            
            if (filteredComplaints.length === 0) {
                complaintsTable.innerHTML = '<tr><td colspan="7" class="text-center">No complaints found</td></tr>';
                return;
            }
            
            // Sort by date (newest first)
            filteredComplaints.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            filteredComplaints.forEach(complaint => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(complaint.date)}</td>
                    <td>${agents[complaint.agent_id]?.name || 'Unknown'}</td>
                    <td>${branches.find(b => b.id === complaint.branch_id)?.name || 'Unknown'}</td>
                    <td>${complaint.customer_id}</td>
                    <td>${formatComplaintType(complaint.type)}</td>
                    <td>${complaint.description.substring(0, 50)}${complaint.description.length > 50 ? '...' : ''}</td>
                    <td><span class="badge ${getComplaintStatusBadgeClass(complaint.resolution_status)}">${formatComplaintStatus(complaint.resolution_status)}</span></td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-info" onclick="viewComplaint('${complaint.id}')">
                                <i class="bi bi-eye-fill"></i>
                            </button>
                            <button class="btn btn-success" onclick="resolveComplaintById('${complaint.id}')">
                                <i class="bi bi-check-circle-fill"></i>
                            </button>
                        </div>
                    </td>
                `;
                complaintsTable.appendChild(row);
            });
        }
        
        // Helper functions for complaint type and status
        function formatComplaintType(type) {
            const types = {
                'delivery': 'Delivery Delay',
                'quality': 'Food Quality',
                'order': 'Order Error',
                'service': 'Customer Service'
            };
            return types[type] || type;
        }
        
        function formatComplaintStatus(status) {
            const statuses = {
                'pending': 'Pending',
                'in_progress': 'In Progress',
                'resolved': 'Resolved'
            };
            return statuses[status] || status;
        }
        
        function getComplaintStatusBadgeClass(status) {
            const classes = {
                'pending': 'bg-warning',
                'in_progress': 'bg-info',
                'resolved': 'bg-success'
            };
            return classes[status] || 'bg-secondary';
        }
        
        // View complaint details
        function viewComplaint(complaintId) {
            const complaint = complaints.find(c => c.id === complaintId);
            if (complaint) {
                currentComplaintId = complaintId;
                
                const complaintDetails = document.getElementById('complaintDetails');
                complaintDetails.innerHTML = `
                    <div class="mb-3">
                        <h5>Complaint #${complaint.customer_id}</h5>
                        <span class="badge ${getComplaintStatusBadgeClass(complaint.resolution_status)}">${formatComplaintStatus(complaint.resolution_status)}</span>
                    </div>
                    <div class="mb-2">
                        <strong>Type:</strong> ${formatComplaintType(complaint.type)}
                    </div>
                    <div class="mb-2">
                        <strong>Date:</strong> ${formatDate(complaint.date)}
                    </div>
                    <div class="mb-2">
                        <strong>Agent:</strong> ${agents[complaint.agent_id]?.name || 'Unknown'}
                    </div>
                    <div class="mb-2">
                        <strong>Branch:</strong> ${branches.find(b => b.id === complaint.branch_id)?.name || 'Unknown'}
                    </div>
                    <div class="mb-2">
                        <strong>Description:</strong> ${complaint.description}
                    </div>
                `;
                
                // Update button based on status
                const resolveBtn = document.getElementById('resolveComplaintBtn');
                if (complaint.resolution_status === 'pending') {
                    resolveBtn.textContent = 'Mark as In Progress';
                    resolveBtn.onclick = () => updateComplaintStatus('in-progress');
                } else if (complaint.resolution_status === 'in_progress') {
                    resolveBtn.textContent = 'Resolve';
                    resolveBtn.onclick = () => updateComplaintStatus('resolved');
                } else {
                    resolveBtn.style.display = 'none';
                }
                
                const modal = new bootstrap.Modal(document.getElementById('viewComplaintModal'));
                modal.show();
            }
        }
        
        // Update complaint status
        function updateComplaintStatus(newStatus) {
            const complaintIndex = complaints.findIndex(c => c.id === currentComplaintId);
            if (complaintIndex !== -1) {
                complaints[complaintIndex].resolution_status = newStatus;
                saveData();
                updateComplaintsTable();
                updateDashboard();
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('viewComplaintModal'));
                modal.hide();
                
                // Show success message
                showToast(`Complaint status updated to "${formatComplaintStatus(newStatus)}"`);
            }
        }
        
        // Resolve complaint by ID
        function resolveComplaintById(complaintId) {
            const complaintIndex = complaints.findIndex(c => c.id === complaintId);
            if (complaintIndex !== -1) {
                complaints[complaintIndex].resolution_status = 'resolved';
                saveData();
                updateComplaintsTable();
                updateDashboard();
                showToast('Complaint marked as resolved');
            }
        }
        
        // Filter complaints
        function filterComplaints() {
            updateComplaintsTable();
        }
        
        // Update agent selects in forms
        function updateAgentSelects() {
            const callAgentSelect = document.getElementById('callAgent');
            const complaintAgentSelect = document.getElementById('complaintAgent');
            const taskAssignedToSelect = document.getElementById('taskAssignedTo');
            
            // Clear existing options
            callAgentSelect.innerHTML = '<option value="">Select Agent</option>';
            complaintAgentSelect.innerHTML = '<option value="">Select Agent</option>';
            taskAssignedToSelect.innerHTML = '<option value="">Select Agent</option>';
            
            // Add agents
            for (const [agentId, agent] of Object.entries(agents)) {
                const option1 = document.createElement('option');
                option1.value = agentId;
                option1.textContent = `${agent.name} (${agentId})`;
                callAgentSelect.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = agentId;
                option2.textContent = `${agent.name} (${agentId})`;
                complaintAgentSelect.appendChild(option2);
                
                const option3 = document.createElement('option');
                option3.value = agentId;
                option3.textContent = `${agent.name} (${agentId})`;
                taskAssignedToSelect.appendChild(option3);
            }
        }
        
        // Update branch selects in forms
        function updateBranchSelects() {
            const callBranchSelect = document.getElementById('callBranch');
            const complaintBranchSelect = document.getElementById('complaintBranch');
            const agentBranchSelect = document.getElementById('agentBranch');
            const dailyBranchFilter = document.getElementById('dailyBranchFilter');
            const weeklyBranchFilter = document.getElementById('weeklyBranchFilter');
            const monthlyBranchFilter = document.getElementById('monthlyBranchFilter');
            const branchReportBranchFilter = document.getElementById('branchReportBranchFilter');
            const customBranchFilter = document.getElementById('customBranchFilter');
            
            // Clear existing options
            callBranchSelect.innerHTML = '<option value="">Select Branch</option>';
            complaintBranchSelect.innerHTML = '<option value="">Select Branch</option>';
            agentBranchSelect.innerHTML = '<option value="">Select Branch</option>';
            dailyBranchFilter.innerHTML = '<option value="all">All Branches</option>';
            weeklyBranchFilter.innerHTML = '<option value="all">All Branches</option>';
            monthlyBranchFilter.innerHTML = '<option value="all">All Branches</option>';
            branchReportBranchFilter.innerHTML = '<option value="">Select Branch</option>';
            customBranchFilter.innerHTML = '<option value="all">All Branches</option>';
            
            // Add branches
            branches.forEach(branch => {
                const option1 = document.createElement('option');
                option1.value = branch.id;
                option1.textContent = branch.name;
                callBranchSelect.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = branch.id;
                option2.textContent = branch.name;
                complaintBranchSelect.appendChild(option2);
                
                const option3 = document.createElement('option');
                option3.value = branch.id;
                option3.textContent = branch.name;
                agentBranchSelect.appendChild(option3);
                
                const option4 = document.createElement('option');
                option4.value = branch.id;
                option4.textContent = branch.name;
                dailyBranchFilter.appendChild(option4);
                
                const option5 = document.createElement('option');
                option5.value = branch.id;
                option5.textContent = branch.name;
                weeklyBranchFilter.appendChild(option5);
                
                const option6 = document.createElement('option');
                option6.value = branch.id;
                option6.textContent = branch.name;
                monthlyBranchFilter.appendChild(option6);
                
                const option7 = document.createElement('option');
                option7.value = branch.id;
                option7.textContent = branch.name;
                branchReportBranchFilter.appendChild(option7);
                
                const option8 = document.createElement('option');
                option8.value = branch.id;
                option8.textContent = branch.name;
                customBranchFilter.appendChild(option8);
            });
        }
        
        // Format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }
        
        // Show modals
        function showAddTaskModal() {
            const modal = new bootstrap.Modal(document.getElementById('addTaskModal'));
            modal.show();
        }
        
        function showAddAgentModal() {
            const modal = new bootstrap.Modal(document.getElementById('addAgentModal'));
            modal.show();
        }
        
        function showAddCallModal() {
            const modal = new bootstrap.Modal(document.getElementById('addCallModal'));
            modal.show();
        }
        
        function showAddComplaintModal() {
            const modal = new bootstrap.Modal(document.getElementById('addComplaintModal'));
            modal.show();
        }
        
        // Form handlers
        document.getElementById('addTaskForm').addEventListener('submit', function(e) {
            e.preventDefault();
            saveTask();
        });
        
        document.getElementById('addAgentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            saveAgent();
        });
        
        document.getElementById('addCallForm').addEventListener('submit', function(e) {
            e.preventDefault();
            saveCall();
        });
        
        document.getElementById('addComplaintForm').addEventListener('submit', function(e) {
            e.preventDefault();
            saveComplaint();
        });
        
        // Save task
        function saveTask() {
            const taskTitle = document.getElementById('taskTitle').value;
            const taskCategory = document.getElementById('taskCategory').value;
            const taskPriority = document.getElementById('taskPriority').value;
            const taskDueDate = document.getElementById('taskDueDate').value;
            const taskDescription = document.getElementById('taskDescription').value;
            const taskAssignedTo = document.getElementById('taskAssignedTo').value;
            
            // Add task
            const newTask = {
                id: Date.now().toString(),
                title: taskTitle,
                category: taskCategory,
                priority: taskPriority,
                due_date: taskDueDate,
                description: taskDescription,
                assigned_to: taskAssignedTo,
                status: 'pending',
                created_at: new Date().toISOString().split('T')[0]
            };
            
            tasks.push(newTask);
            
            // Save data
            saveData();
            
            // Update UI
            updateTasksList();
            updateDashboard();
            
            // Reset form
            document.getElementById('addTaskForm').reset();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addTaskModal'));
            modal.hide();
            
            // Show success message
            showToast('Task added successfully');
        }
        
        // Save agent
        function saveAgent() {
            const agentId = document.getElementById('agentId').value;
            const agentName = document.getElementById('agentName').value;
            const agentPosition = document.getElementById('agentPosition').value;
            const agentContact = document.getElementById('agentContact').value;
            const agentEmail = document.getElementById('agentEmail').value;
            const agentPhone = document.getElementById('agentPhone').value;
            const agentBranch = document.getElementById('agentBranch').value;
            
            // Check if agent ID already exists
            if (agents[agentId]) {
                showToast('Agent ID already exists', 'warning');
                return;
            }
            
            // Add agent
            agents[agentId] = {
                name: agentName,
                position: agentPosition,
                contact: agentContact,
                email: agentEmail,
                phone: agentPhone,
                branch_id: parseInt(agentBranch) || null,
                training_completed: false,
                shifts: [],
                performance: {
                    total_calls: 0,
                    sales: 0,
                    complaints: 0,
                    upsells: 0
                }
            };
            
            // Save data
            saveData();
            
            // Update UI
            updateAgentsTable();
            updateAgentSelects();
            updateDashboard();
            
            // Reset form
            document.getElementById('addAgentForm').reset();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addAgentModal'));
            modal.hide();
            
            // Show success message
            showToast('Agent added successfully');
        }
        
        // Save call
        function saveCall() {
            const agentId = document.getElementById('callAgent').value;
            const branchId = document.getElementById('callBranch').value;
            const callType = document.getElementById('callType').value;
            const callDuration = document.getElementById('callDuration').value;
            const callOutcome = document.getElementById('callOutcome').value;
            const callSale = document.getElementById('callSale').value || 0;
            const callCustomer = document.getElementById('callCustomer').value;
            const callNotes = document.getElementById('callNotes').value;
            
            // Add call log
            const today = new Date().toISOString().split('T')[0];
            const newCall = {
                id: Date.now().toString(),
                date: today,
                agent_id: agentId,
                branch_id: parseInt(branchId) || null,
                call_type: callType,
                duration: parseFloat(callDuration),
                outcome: callOutcome,
                sale_amount: parseFloat(callSale),
                customer_id: callCustomer,
                notes: callNotes
            };
            
            dailyLogs.push(newCall);
            
            // Update agent performance
            if (agents[agentId]) {
                agents[agentId].performance.total_calls += 1;
                agents[agentId].performance.sales += parseFloat(callSale);
                
                // Random chance of upsell for demonstration
                if (Math.random() > 0.7 && parseFloat(callSale) > 0) {
                    agents[agentId].performance.upsells += 1;
                }
            }
            
            // Save data
            saveData();
            
            // Update UI
            updateCallsTable();
            updateDashboard();
            
            // Reset form
            document.getElementById('addCallForm').reset();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addCallModal'));
            modal.hide();
            
            // Show success message
            showToast('Call logged successfully');
        }
        
        // Save complaint
        function saveComplaint() {
            const agentId = document.getElementById('complaintAgent').value;
            const branchId = document.getElementById('complaintBranch').value;
            const customerId = document.getElementById('customerId').value;
            const complaintType = document.getElementById('complaintType').value;
            const complaintStatus = document.getElementById('complaintStatus').value;
            const complaintDescription = document.getElementById('complaintDescription').value;
            const complaintDate = document.getElementById('complaintDate').value || new Date().toISOString().split('T')[0];
            
            // Add complaint
            const newComplaint = {
                id: Date.now().toString(),
                date: complaintDate,
                agent_id: agentId,
                branch_id: parseInt(branchId) || null,
                customer_id: customerId,
                type: complaintType,
                description: complaintDescription,
                resolution_status: complaintStatus
            };
            
            complaints.push(newComplaint);
            
            // Update agent performance
            if (agents[agentId]) {
                agents[agentId].performance.complaints += 1;
            }
            
            // Save data
            saveData();
            
            // Update UI
            updateComplaintsTable();
            updateDashboard();
            
            // Reset form
            document.getElementById('addComplaintForm').reset();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addComplaintModal'));
            modal.hide();
            
            // Show success message
            showToast('Complaint logged successfully');
        }
        
        // Generate daily report
        function generateDailyReport() {
            const date = document.getElementById('dailyDate').value;
            const branchFilter = document.getElementById('dailyBranchFilter').value;
            if (!date) {
                showToast('Please select a date', 'warning');
                return;
            }
            
            // Filter logs for the specified date
            const dailyLogsForDate = dailyLogs.filter(log => log.date === date);
            const dailyComplaintsForDate = complaints.filter(c => c.date === date);
            
            // Apply branch filter if selected
            let filteredLogs = dailyLogsForDate;
            let filteredComplaints = dailyComplaintsForDate;
            
            if (branchFilter !== 'all') {
                filteredLogs = filteredLogs.filter(log => log.branch_id === parseInt(branchFilter));
                filteredComplaints = filteredComplaints.filter(c => c.branch_id === parseInt(branchFilter));
            }
            
            if (filteredLogs.length === 0) {
                document.getElementById('dailyReportContent').innerHTML = '<div class="alert alert-info">No data available for the selected date</div>';
                return;
            }
            
            // Calculate metrics
            const totalCalls = filteredLogs.length;
            const totalSales = filteredLogs.reduce((sum, log) => sum + parseFloat(log.sale_amount || 0), 0);
            const avgHandleTime = filteredLogs.reduce((sum, log) => sum + parseFloat(log.duration), 0) / totalCalls;
            
            // Calculate FCR (First Call Resolution)
            const resolvedCalls = filteredLogs.filter(log => log.outcome === 'resolved' || log.outcome === 'order_placed').length;
            const fcrRate = (resolvedCalls / totalCalls) * 100;
            
            // Agent performance
            const agentPerformance = {};
            filteredLogs.forEach(log => {
                if (!agentPerformance[log.agent_id]) {
                    agentPerformance[log.agent_id] = {
                        calls: 0,
                        sales: 0
                    };
                }
                agentPerformance[log.agent_id].calls += 1;
                agentPerformance[log.agent_id].sales += parseFloat(log.sale_amount || 0);
            });
            
            // Branch performance
            const branchPerformance = {};
            filteredLogs.forEach(log => {
                if (!branchPerformance[log.branch_id]) {
                    branchPerformance[log.branch_id] = {
                        calls: 0,
                        sales: 0
                    };
                }
                branchPerformance[log.branch_id].calls += 1;
                branchPerformance[log.branch_id].sales += parseFloat(log.sale_amount || 0);
            });
            
            // Generate report HTML
            let reportHTML = `
                <div class="report-card">
                    <div class="report-header">
                        <div class="report-title">Daily Performance Report - ${formatDate(date)}</div>
                        <div class="report-actions">
                            <button class="btn btn-sm btn-outline-primary" onclick="exportReport('daily')">
                                <i class="bi bi-download"></i> Export
                            </button>
                        </div>
                    </div>
                    
                    <div class="report-summary">
                        <h5>Performance Summary</h5>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="kpi-card">
                                    <div class="kpi-value">${totalCalls}</div>
                                    <div class="kpi-label">Total Calls</div>
                                    <div class="kpi-change positive">
                                        <i class="bi bi-arrow-up"></i> 5% from yesterday
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="kpi-card">
                                    <div class="kpi-value">AED ${totalSales.toFixed(2)}</div>
                                    <div class="kpi-label">Total Sales</div>
                                    <div class="kpi-change positive">
                                        <i class="bi bi-arrow-up"></i> 12% from yesterday
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="kpi-card">
                                    <div class="kpi-value">${avgHandleTime.toFixed(2)} min</div>
                                    <div class="kpi-label">Avg. Handle Time</div>
                                    <div class="kpi-change negative">
                                        <i class="bi bi-arrow-down"></i> 3% from yesterday
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="kpi-card">
                                    <div class="kpi-value">${fcrRate.toFixed(1)}%</div>
                                    <div class="kpi-label">First Call Resolution</div>
                                    <div class="kpi-change positive">
                                        <i class="bi bi-arrow-up"></i> 2% from yesterday
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="report-chart">
                        <h5>Call Distribution by Type</h5>
                        <div class="chart-container">
                            <canvas id="dailyCallTypeChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="report-table">
                        <h5>Agent Performance</h5>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Agent</th>
                                        <th>Calls</th>
                                        <th>Sales (AED)</th>
                                        <th>Avg. Sale/Call</th>
                                        <th>Performance</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            // Sort agents by sales
            const sortedAgents = Object.entries(agentPerformance).sort((a, b) => b[1].sales - a[1].sales);
            
            sortedAgents.forEach(([agentId, perf]) => {
                const avgSalePerCall = perf.calls > 0 ? perf.sales / perf.calls : 0;
                const performanceClass = avgSalePerCall > 20 ? 'high' : avgSalePerCall > 10 ? 'medium' : 'low';
                
                reportHTML += `
                    <tr>
                        <td>${agents[agentId]?.name || 'Unknown'}</td>
                        <td>${perf.calls}</td>
                        <td>AED ${perf.sales.toFixed(2)}</td>
                        <td>AED ${avgSalePerCall.toFixed(2)}</td>
                        <td>
                            <div class="performance-indicator performance-${performanceClass}"></div>
                        </td>
                    </tr>
                `;
            });
            
            reportHTML += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="report-table">
                        <h5>Branch Performance</h5>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Branch</th>
                                        <th>Calls</th>
                                        <th>Sales (AED)</th>
                                        <th>Avg. Sale/Call</th>
                                        <th>Performance</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            // Sort branches by sales
            const sortedBranches = Object.entries(branchPerformance).sort((a, b) => b[1].sales - a[1].sales);
            
            sortedBranches.forEach(([branchId, perf]) => {
                const avgSalePerCall = perf.calls > 0 ? perf.sales / perf.calls : 0;
                const performanceClass = avgSalePerCall > 20 ? 'high' : avgSalePerCall > 10 ? 'medium' : 'low';
                
                reportHTML += `
                    <tr>
                        <td>${branches.find(b => b.id === parseInt(branchId))?.name || 'Unknown'}</td>
                        <td>${perf.calls}</td>
                        <td>AED ${perf.sales.toFixed(2)}</td>
                        <td>AED ${avgSalePerCall.toFixed(2)}</td>
                        <td>
                            <div class="performance-indicator performance-${performanceClass}"></div>
                        </td>
                    </tr>
                `;
            });
            
            reportHTML += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="report-table">
                        <h5>Complaint Analysis</h5>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Complaint Type</th>
                                        <th>Count</th>
                                        <th>Percentage</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            // Count complaints by type
            const complaintTypes = {};
            filteredComplaints.forEach(complaint => {
                if (!complaintTypes[complaint.type]) {
                    complaintTypes[complaint.type] = 0;
                }
                complaintTypes[complaint.type] += 1;
            });
            
            // Sort by count
            const sortedComplaintTypes = Object.entries(complaintTypes).sort((a, b) => b[1] - a[1]);
            
            sortedComplaintTypes.forEach(([type, count]) => {
                const percentage = (count / filteredComplaints.length) * 100;
                reportHTML += `
                    <tr>
                        <td>${formatComplaintType(type)}</td>
                        <td>${count}</td>
                        <td>${percentage.toFixed(1)}%</td>
                    </tr>
                `;
            });
            
            reportHTML += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="report-footer">
                        Report generated on ${new Date().toLocaleString()}
                    </div>
                </div>
            `;
            
            document.getElementById('dailyReportContent').innerHTML = reportHTML;
            
            // Initialize call type chart
            const callTypeCtx = document.getElementById('dailyCallTypeChart').getContext('2d');
            
            // Count calls by type
            const callTypes = {
                'Order': filteredLogs.filter(log => log.call_type === 'order').length,
                'Inquiry': filteredLogs.filter(log => log.call_type === 'inquiry').length,
                'Complaint': filteredLogs.filter(log => log.call_type === 'complaint').length
            };
            
            new Chart(callTypeCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys(callTypes),
                    datasets: [{
                        data: Object.values(callTypes),
                        backgroundColor: [
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(255, 99, 132, 0.7)'
                        ],
                        borderColor: [
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(255, 99, 132, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
        
        // Generate weekly report
        function generateWeeklyReport() {
            const weekStart = document.getElementById('weekStart').value;
            const branchFilter = document.getElementById('weeklyBranchFilter').value;
            if (!weekStart) {
                showToast('Please select a week start date', 'warning');
                return;
            }
            
            // Calculate end of week (6 days after start)
            const startDate = new Date(weekStart);
            const endDate = new Date(startDate);
            endDate.setDate(endDate.getDate() + 6);
            
            // Format dates for comparison
            const startStr = startDate.toISOString().split('T')[0];
            const endStr = endDate.toISOString().split('T')[0];
            
            // Filter logs for the week
            const weeklyLogs = dailyLogs.filter(log => {
                const logDate = new Date(log.date);
                return logDate >= startDate && logDate <= endDate;
            });
            
            const weeklyComplaints = complaints.filter(c => {
                const complaintDate = new Date(c.date);
                return complaintDate >= startDate && complaintDate <= endDate;
            });
            
            // Apply branch filter if selected
            let filteredLogs = weeklyLogs;
            let filteredComplaints = weeklyComplaints;
            
            if (branchFilter !== 'all') {
                filteredLogs = filteredLogs.filter(log => log.branch_id === parseInt(branchFilter));
                filteredComplaints = filteredComplaints.filter(c => c.branch_id === parseInt(branchFilter));
            }
            
            if (filteredLogs.length === 0) {
                document.getElementById('weeklyReportContent').innerHTML = '<div class="alert alert-info">No data available for the selected week</div>';
                return;
            }
            
            // Calculate metrics
            const totalCalls = filteredLogs.length;
            const totalSales = filteredLogs.reduce((sum, log) => sum + parseFloat(log.sale_amount || 0), 0);
            const avgHandleTime = filteredLogs.reduce((sum, log) => sum + parseFloat(log.duration), 0) / totalCalls;
            
            // Calculate FCR (First Call Resolution)
            const resolvedCalls = filteredLogs.filter(log => log.outcome === 'resolved' || log.outcome === 'order_placed').length;
            const fcrRate = (resolvedCalls / totalCalls) * 100;
            
            // Daily breakdown
            const dailyBreakdown = {};
            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                const dateStr = d.toISOString().split('T')[0];
                dailyBreakdown[dateStr] = {
                    calls: 0,
                    sales: 0
                };
            }
            
            filteredLogs.forEach(log => {
                dailyBreakdown[log.date].calls += 1;
                dailyBreakdown[log.date].sales += parseFloat(log.sale_amount || 0);
            });
            
            // Generate report HTML
            let reportHTML = `
                <div class="report-card">
                    <div class="report-header">
                        <div class="report-title">Weekly Performance Report - ${formatDate(startStr)} to ${formatDate(endStr)}</div>
                        <div class="report-actions">
                            <button class="btn btn-sm btn-outline-primary" onclick="exportReport('weekly')">
                                <i class="bi bi-download"></i> Export
                            </button>
                        </div>
                    </div>
                    
                    <div class="report-summary">
                        <h5>Performance Summary</h5>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="kpi-card">
                                    <div class="kpi-value">${totalCalls}</div>
                                    <div class="kpi-label">Total Calls</div>
                                    <div class="kpi-change positive">
                                        <i class="bi bi-arrow-up"></i> 8% from last week
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="kpi-card">
                                    <div class="kpi-value">AED ${totalSales.toFixed(2)}</div>
                                    <div class="kpi-label">Total Sales</div>
                                    <div class="kpi-change positive">
                                        <i class="bi bi-arrow-up"></i> 15% from last week
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="kpi-card">
                                    <div class="kpi-value">${avgHandleTime.toFixed(2)} min</div>
                                    <div class="kpi-label">Avg. Handle Time</div>
                                    <div class="kpi-change negative">
                                        <i class="bi bi-arrow-down"></i> 5% from last week
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="kpi-card">
                                    <div class="kpi-value">${fcrRate.toFixed(1)}%</div>
                                    <div class="kpi-label">First Call Resolution</div>
                                    <div class="kpi-change positive">
                                        <i class="bi bi-arrow-up"></i> 3% from last week
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="report-chart">
                        <h5>Daily Sales Trend</h5>
                        <div class="chart-container">
                            <canvas id="weeklySalesChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="report-table">
                        <h5>Daily Breakdown</h5>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Day</th>
                                        <th>Calls</th>
                                        <th>Sales (AED)</th>
                                        <th>Avg. Sale/Call</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            // Sort by date
            const sortedDays = Object.entries(dailyBreakdown).sort((a, b) => new Date(a[0]) - new Date(b[0]));
            
            sortedDays.forEach(([date, perf]) => {
                const avgSalePerCall = perf.calls > 0 ? perf.sales / perf.calls : 0;
                const dayName = new Date(date).toLocaleDateString('en', { weekday: 'long' });
                reportHTML += `
                    <tr>
                        <td>${formatDate(date)}</td>
                        <td>${dayName}</td>
                        <td>${perf.calls}</td>
                        <td>AED ${perf.sales.toFixed(2)}</td>
                        <td>AED ${avgSalePerCall.toFixed(2)}</td>
                    </tr>
                `;
            });
            
            reportHTML += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="report-table">
                        <h5>Top Complaints</h5>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Complaint Type</th>
                                        <th>Count</th>
                                        <th>Percentage</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            // Count complaints by type
            const complaintTypes = {};
            filteredComplaints.forEach(complaint => {
                if (!complaintTypes[complaint.type]) {
                    complaintTypes[complaint.type] = 0;
                }
                complaintTypes[complaint.type] += 1;
            });
            
            // Sort by count
            const sortedComplaintTypes = Object.entries(complaintTypes).sort((a, b) => b[1] - a[1]);
            
            sortedComplaintTypes.forEach(([type, count]) => {
                const percentage = filteredComplaints.length > 0 ? (count / filteredComplaints.length) * 100 : 0;
                reportHTML += `
                    <tr>
                        <td>${formatComplaintType(type)}</td>
                        <td>${count}</td>
                        <td>${percentage.toFixed(1)}%</td>
                    </tr>
                `;
            });
            
            reportHTML += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="report-footer">
                        Report generated on ${new Date().toLocaleString()}
                    </div>
                </div>
            `;
            
            document.getElementById('weeklyReportContent').innerHTML = reportHTML;
            
            // Initialize sales chart
            const salesCtx = document.getElementById('weeklySalesChart').getContext('2d');
            
            // Prepare data for chart
            const labels = [];
            const data = [];
            
            sortedDays.forEach(([date, perf]) => {
                labels.push(new Date(date).toLocaleDateString('en', { weekday: 'short' }));
                data.push(perf.sales);
            });
            
            new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Sales (AED)',
                        data: data,
                        backgroundColor: 'rgba(228, 0, 43, 0.2)',
                        borderColor: 'rgba(228, 0, 43, 1)',
                        borderWidth: 2,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Generate monthly report
        function generateMonthlyReport() {
            const monthYear = document.getElementById('monthYear').value;
            const branchFilter = document.getElementById('monthlyBranchFilter').value;
            if (!monthYear) {
                showToast('Please select a month and year', 'warning');
                return;
            }
            
            // Filter logs for the month
            const monthlyLogs = dailyLogs.filter(log => log.date.startsWith(monthYear));
            const monthlyComplaints = complaints.filter(c => c.date.startsWith(monthYear));
            
            // Apply branch filter if selected
            let filteredLogs = monthlyLogs;
            let filteredComplaints = monthlyComplaints;
            
            if (branchFilter !== 'all') {
                filteredLogs = filteredLogs.filter(log => log.branch_id === parseInt(branchFilter));
                filteredComplaints = filteredComplaints.filter(c => c.branch_id === parseInt(branchFilter));
            }
            
            if (filteredLogs.length === 0) {
                document.getElementById('monthlyReportContent').innerHTML = '<div class="alert alert-info">No data available for the selected month</div>';
                return;
            }
            
            // Calculate metrics
            const totalCalls = filteredLogs.length;
            const totalSales = filteredLogs.reduce((sum, log) => sum + parseFloat(log.sale_amount || 0), 0);
            const avgHandleTime = filteredLogs.reduce((sum, log) => sum + parseFloat(log.duration), 0) / totalCalls;
            
            // Calculate FCR (First Call Resolution)
            const resolvedCalls = filteredLogs.filter(log => log.outcome === 'resolved' || log.outcome === 'order_placed').length;
            const fcrRate = (resolvedCalls / totalCalls) * 100;
            
            // Weekly breakdown
            const weeklyBreakdown = {};
            
            // Get all weeks in the month
            const [year, month] = monthYear.split('-').map(Number);
            const firstDay = new Date(year, month - 1, 1);
            const lastDay = new Date(year, month, 0);
            
            // Initialize weeks
            for (let d = new Date(firstDay); d <= lastDay; d.setDate(d.getDate() + 7)) {
                const weekNum = getWeekNumber(d);
                weeklyBreakdown[`Week ${weekNum}`] = {
                    calls: 0,
                    sales: 0
                };
            }
            
            filteredLogs.forEach(log => {
                const logDate = new Date(log.date);
                const weekNum = getWeekNumber(logDate);
                const weekKey = `Week ${weekNum}`;
                
                if (!weeklyBreakdown[weekKey]) {
                    weeklyBreakdown[weekKey] = {
                        calls: 0,
                        sales: 0
                    };
                }
                
                weeklyBreakdown[weekKey].calls += 1;
                weeklyBreakdown[weekKey].sales += parseFloat(log.sale_amount || 0);
            });
            
            // Generate report HTML
            let reportHTML = `
                <div class="report-card">
                    <div class="report-header">
                        <div class="report-title">Monthly Performance Report - ${new Date(year, month - 1).toLocaleDateString('en', { month: 'long', year: 'numeric' })}</div>
                        <div class="report-actions">
                            <button class="btn btn-sm btn-outline-primary" onclick="exportReport('monthly')">
                                <i class="bi bi-download"></i> Export
                            </button>
                        </div>
                    </div>
                    
                    <div class="report-summary">
                        <h5>Performance Summary</h5>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="kpi-card">
                                    <div class="kpi-value">${totalCalls}</div>
                                    <div class="kpi-label">Total Calls</div>
                                    <div class="kpi-change positive">
                                        <i class="bi bi-arrow-up"></i> 12% from last month
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="kpi-card">
                                    <div class="kpi-value">AED ${totalSales.toFixed(2)}</div>
                                    <div class="kpi-label">Total Sales</div>
                                    <div class="kpi-change positive">
                                        <i class="bi bi-arrow-up"></i> 18% from last month
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="kpi-card">
                                    <div class="kpi-value">${avgHandleTime.toFixed(2)} min</div>
                                    <div class="kpi-label">Avg. Handle Time</div>
                                    <div class="kpi-change negative">
                                        <i class="bi bi-arrow-down"></i> 7% from last month
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="kpi-card">
                                    <div class="kpi-value">${fcrRate.toFixed(1)}%</div>
                                    <div class="kpi-label">First Call Resolution</div>
                                    <div class="kpi-change positive">
                                        <i class="bi bi-arrow-up"></i> 5% from last month
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="report-chart">
                        <h5>Weekly Sales Trend</h5>
                        <div class="chart-container">
                            <canvas id="monthlySalesChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="report-table">
                        <h5>Weekly Breakdown</h5>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Week</th>
                                        <th>Calls</th>
                                        <th>Sales (AED)</th>
                                        <th>Avg. Sale/Call</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            // Sort by week number
            const sortedWeeks = Object.entries(weeklyBreakdown).sort((a, b) => {
                const weekA = parseInt(a[0].split(' ')[1]);
                const weekB = parseInt(b[0].split(' ')[1]);
                return weekA - weekB;
            });
            
            sortedWeeks.forEach(([week, perf]) => {
                const avgSalePerCall = perf.calls > 0 ? perf.sales / perf.calls : 0;
                reportHTML += `
                    <tr>
                        <td>${week}</td>
                        <td>${perf.calls}</td>
                        <td>AED ${perf.sales.toFixed(2)}</td>
                        <td>AED ${avgSalePerCall.toFixed(2)}</td>
                    </tr>
                `;
            });
            
            reportHTML += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="report-table">
                        <h5>Agent Performance Ranking</h5>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Rank</th>
                                        <th>Agent</th>
                                        <th>Calls</th>
                                        <th>Sales (AED)</th>
                                        <th>Complaints</th>
                                        <th>Upsells</th>
                                        <th>Performance Score</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            // Agent performance for the month
            const agentPerformance = {};
            
            // Initialize with all agents
            for (const agentId in agents) {
                agentPerformance[agentId] = {
                    name: agents[agentId].name,
                    calls: 0,
                    sales: 0,
                    complaints: 0,
                    upsells: 0
                };
            }
            
            // Calculate performance
            filteredLogs.forEach(log => {
                if (agentPerformance[log.agent_id]) {
                    agentPerformance[log.agent_id].calls += 1;
                    agentPerformance[log.agent_id].sales += parseFloat(log.sale_amount || 0);
                    
                    // Random chance of upsell for demonstration
                    if (Math.random() > 0.7 && parseFloat(log.sale_amount || 0) > 0) {
                        agentPerformance[log.agent_id].upsells += 1;
                    }
                }
            });
            
            filteredComplaints.forEach(complaint => {
                if (agentPerformance[complaint.agent_id]) {
                    agentPerformance[complaint.agent_id].complaints += 1;
                }
            });
            
            // Calculate performance score (simplified formula)
            for (const agentId in agentPerformance) {
                const perf = agentPerformance[agentId];
                const salesPerCall = perf.calls > 0 ? perf.sales / perf.calls : 0;
                const complaintRatio = perf.calls > 0 ? perf.complaints / perf.calls : 0;
                
                // Performance score: 50% sales per call, 30% FCR (inverse of complaint ratio), 20% upsell ratio
                const salesScore = Math.min(salesPerCall / 30 * 50, 50); // Max 50 points for sales
                const fcrScore = Math.max(50 - complaintRatio * 500, 0); // Max 50 points for FCR
                const upsellScore = Math.min(perf.upsells / perf.calls * 20 * 20, 20); // Max 20 points for upsells
                
                perf.score = salesScore + fcrScore + upsellScore;
            }
            
            // Sort by score
            const sortedAgents = Object.entries(agentPerformance).sort((a, b) => b[1].score - a[1].score);
            
            sortedAgents.forEach(([agentId, perf], index) => {
                const salesPerCall = perf.calls > 0 ? perf.sales / perf.calls : 0;
                const scoreClass = perf.score > 80 ? 'high' : perf.score > 60 ? 'medium' : 'low';
                
                reportHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${perf.name}</td>
                        <td>${perf.calls}</td>
                        <td>AED ${perf.sales.toFixed(2)}</td>
                        <td>${perf.complaints}</td>
                        <td>${perf.upsells}</td>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="me-2">${perf.score.toFixed(1)}</div>
                                <div class="performance-indicator performance-${scoreClass}"></div>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            reportHTML += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="report-footer">
                        Report generated on ${new Date().toLocaleString()}
                    </div>
                </div>
            `;
            
            document.getElementById('monthlyReportContent').innerHTML = reportHTML;
            
            // Initialize sales chart
            const salesCtx = document.getElementById('monthlySalesChart').getContext('2d');
            
            // Prepare data for chart
            const labels = [];
            const data = [];
            
            sortedWeeks.forEach(([week, perf]) => {
                labels.push(week);
                data.push(perf.sales);
            });
            
            new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Sales (AED)',
                        data: data,
                        backgroundColor: 'rgba(228, 0, 43, 0.2)',
                        borderColor: 'rgba(228, 0, 43, 1)',
                        borderWidth: 2,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Generate branch report
        function generateBranchReport() {
            const branchId = document.getElementById('branchReportBranchFilter').value;
            const period = document.getElementById('branchReportPeriodFilter').value;
            
            if (!branchId) {
                showToast('Please select a branch', 'warning');
                return;
            }
            
            const branch = branches.find(b => b.id === parseInt(branchId));
            if (!branch) {
                showToast('Branch not found', 'warning');
                return;
            }
            
            // Calculate date range based on period
            const today = new Date();
            let startDate, endDate, periodLabel;
            
            if (period === 'month') {
                startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                periodLabel = `${today.toLocaleDateString('en', { month: 'long', year: 'numeric' })}`;
            } else if (period === 'quarter') {
                const quarter = Math.floor(today.getMonth() / 3);
                startDate = new Date(today.getFullYear(), quarter * 3, 1);
                endDate = new Date(today.getFullYear(), (quarter + 1) * 3, 0);
                periodLabel = `Q${quarter + 1} ${today.getFullYear()}`;
            } else { // year
                startDate = new Date(today.getFullYear(), 0, 1);
                endDate = new Date(today.getFullYear(), 11, 31);
                periodLabel = `${today.getFullYear()}`;
            }
            
            // Format dates for comparison
            const startStr = startDate.toISOString().split('T')[0];
            const endStr = endDate.toISOString().split('T')[0];
            
            // Filter logs for the period
            const periodLogs = dailyLogs.filter(log => {
                const logDate = new Date(log.date);
                return logDate >= startDate && logDate <= endDate && log.branch_id === parseInt(branchId);
            });
            
            const periodComplaints = complaints.filter(c => {
                const complaintDate = new Date(c.date);
                return complaintDate >= startDate && complaintDate <= endDate && c.branch_id === parseInt(branchId);
            });
            
            if (periodLogs.length === 0) {
                document.getElementById('branchReportContent').innerHTML = '<div class="alert alert-info">No data available for the selected branch and period</div>';
                return;
            }
            
            // Calculate metrics
            const totalCalls = periodLogs.length;
            const totalSales = periodLogs.reduce((sum, log) => sum + parseFloat(log.sale_amount || 0), 0);
            const avgHandleTime = periodLogs.reduce((sum, log) => sum + parseFloat(log.duration), 0) / totalCalls;
            
            // Calculate FCR (First Call Resolution)
            const resolvedCalls = periodLogs.filter(log => log.outcome === 'resolved' || log.outcome === 'order_placed').length;
            const fcrRate = (resolvedCalls / totalCalls) * 100;
            
            // Generate report HTML
            let reportHTML = `
                <div class="report-card">
                    <div class="report-header">
                        <div class="report-title">Branch Performance Report - ${branch.name}</div>
                        <div class="report-actions">
                            <button class="btn btn-sm btn-outline-primary" onclick="exportReport('branch')">
                                <i class="bi bi-download"></i> Export
                            </button>
                        </div>
                    </div>
                    
                    <div class="report-summary">
                        <h5>Branch Information</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <table class="table table-sm">
                                    <tr>
                                        <td class="fw-bold">Branch Name:</td>
                                        <td>${branch.name}</td>
                                    </tr>
                                    <tr>
                                        <td class="fw-bold">City:</td>
                                        <td>${branch.city}</td>
                                    </tr>
                                    <tr>
                                        <td class="fw-bold">Area:</td>
                                        <td>${branch.area}</td>
                                    </tr>
                                    <tr>
                                        <td class="fw-bold">Manager:</td>
                                        <td>${branch.managerName}</td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-md-6">
                                <table class="table table-sm">
                                    <tr>
                                        <td class="fw-bold">Contact:</td>
                                        <td>${branch.landline}</td>
                                    </tr>
                                    <tr>
                                        <td class="fw-bold">Rating:</td>
                                        <td>${generateStarRating(branch.rating)}</td>
                                    </tr>
                                    <tr>
                                        <td class="fw-bold">Delivery Status:</td>
                                        <td>${branch.deliveryStatus}</td>
                                    </tr>
                                    <tr>
                                        <td class="fw-bold">Period:</td>
                                        <td>${periodLabel}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div class="report-summary">
                        <h5>Performance Summary</h5>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="kpi-card">
                                    <div class="kpi-value">${totalCalls}</div>
                                    <div class="kpi-label">Total Calls</div>
                                    <div class="kpi-change positive">
                                        <i class="bi bi-arrow-up"></i> 10% from last period
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="kpi-card">
                                    <div class="kpi-value">AED ${totalSales.toFixed(2)}</div>
                                    <div class="kpi-label">Total Sales</div>
                                    <div class="kpi-change positive">
                                        <i class="bi bi-arrow-up"></i> 15% from last period
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="kpi-card">
                                    <div class="kpi-value">${avgHandleTime.toFixed(2)} min</div>
                                    <div class="kpi-label">Avg. Handle Time</div>
                                    <div class="kpi-change negative">
                                        <i class="bi bi-arrow-down"></i> 5% from last period
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="kpi-card">
                                    <div class="kpi-value">${fcrRate.toFixed(1)}%</div>
                                    <div class="kpi-label">First Call Resolution</div>
                                    <div class="kpi-change positive">
                                        <i class="bi bi-arrow-up"></i> 3% from last period
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="report-chart">
                        <h5>Call Type Distribution</h5>
                        <div class="chart-container">
                            <canvas id="branchCallTypeChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="report-table">
                        <h5>Agent Performance</h5>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Agent</th>
                                        <th>Calls</th>
                                        <th>Sales (AED)</th>
                                        <th>Avg. Sale/Call</th>
                                        <th>Complaints</th>
                                        <th>Performance</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            // Agent performance for the branch
            const agentPerformance = {};
            
            // Initialize with all agents assigned to this branch
            for (const agentId in agents) {
                if (agents[agentId].branch_id === parseInt(branchId)) {
                    agentPerformance[agentId] = {
                        name: agents[agentId].name,
                        calls: 0,
                        sales: 0,
                        complaints: 0
                    };
                }
            }
            
            // Calculate performance
            periodLogs.forEach(log => {
                if (agentPerformance[log.agent_id]) {
                    agentPerformance[log.agent_id].calls += 1;
                    agentPerformance[log.agent_id].sales += parseFloat(log.sale_amount || 0);
                }
            });
            
            periodComplaints.forEach(complaint => {
                if (agentPerformance[complaint.agent_id]) {
                    agentPerformance[complaint.agent_id].complaints += 1;
                }
            });
            
            // Sort by sales
            const sortedAgents = Object.entries(agentPerformance).sort((a, b) => b[1].sales - a[1].sales);
            
            sortedAgents.forEach(([agentId, perf]) => {
                const avgSalePerCall = perf.calls > 0 ? perf.sales / perf.calls : 0;
                const performanceClass = avgSalePerCall > 20 ? 'high' : avgSalePerCall > 10 ? 'medium' : 'low';
                
                reportHTML += `
                    <tr>
                        <td>${perf.name}</td>
                        <td>${perf.calls}</td>
                        <td>AED ${perf.sales.toFixed(2)}</td>
                        <td>AED ${avgSalePerCall.toFixed(2)}</td>
                        <td>${perf.complaints}</td>
                        <td>
                            <div class="performance-indicator performance-${performanceClass}"></div>
                        </td>
                    </tr>
                `;
            });
            
            reportHTML += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="report-table">
                        <h5>Complaint Analysis</h5>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Complaint Type</th>
                                        <th>Count</th>
                                        <th>Percentage</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            // Count complaints by type and status
            const complaintTypes = {};
            const complaintStatuses = {};
            
            periodComplaints.forEach(complaint => {
                // Count by type
                if (!complaintTypes[complaint.type]) {
                    complaintTypes[complaint.type] = 0;
                }
                complaintTypes[complaint.type] += 1;
                
                // Count by status
                if (!complaintStatuses[complaint.resolution_status]) {
                    complaintStatuses[complaint.resolution_status] = 0;
                }
                complaintStatuses[complaint.resolution_status] += 1;
            });
            
            // Sort by count
            const sortedComplaintTypes = Object.entries(complaintTypes).sort((a, b) => b[1] - a[1]);
            
            sortedComplaintTypes.forEach(([type, count]) => {
                const percentage = periodComplaints.length > 0 ? (count / periodComplaints.length) * 100 : 0;
                reportHTML += `
                    <tr>
                        <td>${formatComplaintType(type)}</td>
                        <td>${count}</td>
                        <td>${percentage.toFixed(1)}%</td>
                        <td>
                            <div class="progress">
                                <div class="progress-bar" role="progressbar" style="width: ${percentage}%" aria-valuenow="${percentage}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            reportHTML += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="report-footer">
                        Report generated on ${new Date().toLocaleString()}
                    </div>
                </div>
            `;
            
            document.getElementById('branchReportContent').innerHTML = reportHTML;
            
            // Initialize call type chart
            const callTypeCtx = document.getElementById('branchCallTypeChart').getContext('2d');
            
            // Count calls by type
            const callTypes = {
                'Order': periodLogs.filter(log => log.call_type === 'order').length,
                'Inquiry': periodLogs.filter(log => log.call_type === 'inquiry').length,
                'Complaint': periodLogs.filter(log => log.call_type === 'complaint').length
            };
            
            new Chart(callTypeCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(callTypes),
                    datasets: [{
                        data: Object.values(callTypes),
                        backgroundColor: [
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(255, 99, 132, 0.7)'
                        ],
                        borderColor: [
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(255, 99, 132, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
        
        // Generate custom report
        function generateCustomReport() {
            const startDate = document.getElementById('customStartDate').value;
            const endDate = document.getElementById('customEndDate').value;
            const branchFilter = document.getElementById('customBranchFilter').value;
            const selectedMetrics = Array.from(document.getElementById('customMetrics').selectedOptions).map(option => option.value);
            
            if (!startDate || !endDate) {
                showToast('Please select start and end dates', 'warning');
                return;
            }
            
            if (selectedMetrics.length === 0) {
                showToast('Please select at least one metric', 'warning');
                return;
            }
            
            // Format dates for comparison
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            // Filter logs for the date range
            const customLogs = dailyLogs.filter(log => {
                const logDate = new Date(log.date);
                return logDate >= start && logDate <= end;
            });
            
            const customComplaints = complaints.filter(c => {
                const complaintDate = new Date(c.date);
                return complaintDate >= start && complaintDate <= end;
            });
            
            // Apply branch filter if selected
            let filteredLogs = customLogs;
            let filteredComplaints = customComplaints;
            
            if (branchFilter !== 'all') {
                filteredLogs = filteredLogs.filter(log => log.branch_id === parseInt(branchFilter));
                filteredComplaints = filteredComplaints.filter(c => c.branch_id === parseInt(branchFilter));
            }
            
            if (filteredLogs.length === 0) {
                document.getElementById('customReportContent').innerHTML = '<div class="alert alert-info">No data available for the selected date range</div>';
                return;
            }
            
            // Calculate metrics
            const totalCalls = filteredLogs.length;
            const totalSales = filteredLogs.reduce((sum, log) => sum + parseFloat(log.sale_amount || 0), 0);
            const avgHandleTime = filteredLogs.reduce((sum, log) => sum + parseFloat(log.duration), 0) / totalCalls;
            
            // Calculate FCR (First Call Resolution)
            const resolvedCalls = filteredLogs.filter(log => log.outcome === 'resolved' || log.outcome === 'order_placed').length;
            const fcrRate = (resolvedCalls / totalCalls) * 100;
            
            // Generate report HTML
            let reportHTML = `
                <div class="report-card">
                    <div class="report-header">
                        <div class="report-title">Custom Report</div>
                        <div class="report-actions">
                            <button class="btn btn-sm btn-outline-primary" onclick="exportReport('custom')">
                                <i class="bi bi-download"></i> Export
                            </button>
                        </div>
                    </div>
                    
                    <div class="report-summary">
                        <h5>Report Parameters</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <table class="table table-sm">
                                    <tr>
                                        <td class="fw-bold">Date Range:</td>
                                        <td>${formatDate(startDate)} to ${formatDate(endDate)}</td>
                                    </tr>
                                    <tr>
                                        <td class="fw-bold">Branch:</td>
                                        <td>${branchFilter === 'all' ? 'All Branches' : branches.find(b => b.id === parseInt(branchFilter))?.name || 'Unknown'}</td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-md-6">
                                <table class="table table-sm">
                                    <tr>
                                        <td class="fw-bold">Metrics Included:</td>
                                        <td>${selectedMetrics.map(m => m.charAt(0).toUpperCase() + m.slice(1)).join(', ')}</td>
                                    </tr>
                                    <tr>
                                        <td class="fw-bold">Total Records:</td>
                                        <td>${filteredLogs.length} calls, ${filteredComplaints.length} complaints</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
            `;
            
            // Add selected metrics sections
            if (selectedMetrics.includes('calls')) {
                reportHTML += `
                    <div class="report-chart">
                        <h5>Call Volume</h5>
                        <div class="chart-container">
                            <canvas id="customCallsChart"></canvas>
                        </div>
                    </div>
                `;
            }
            
            if (selectedMetrics.includes('sales')) {
                reportHTML += `
                    <div class="report-chart">
                        <h5>Sales Performance</h5>
                        <div class="chart-container">
                            <canvas id="customSalesChart"></canvas>
                        </div>
                    </div>
                `;
            }
            
            if (selectedMetrics.includes('fcr')) {
                reportHTML += `
                    <div class="report-chart">
                        <h5>First Call Resolution Rate</h5>
                        <div class="chart-container">
                            <canvas id="customFcrChart"></canvas>
                        </div>
                    </div>
                `;
            }
            
            if (selectedMetrics.includes('aht')) {
                reportHTML += `
                    <div class="report-chart">
                        <h5>Average Handle Time</h5>
                        <div class="chart-container">
                            <canvas id="customAhtChart"></canvas>
                        </div>
                    </div>
                `;
            }
            
            if (selectedMetrics.includes('complaints')) {
                reportHTML += `
                    <div class="report-chart">
                        <h5>Complaint Analysis</h5>
                        <div class="chart-container">
                            <canvas id="customComplaintsChart"></canvas>
                        </div>
                    </div>
                `;
            }
            
            if (selectedMetrics.includes('agent')) {
                reportHTML += `
                    <div class="report-table">
                        <h5>Agent Performance</h5>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Agent</th>
                                        <th>Calls</th>
                                        <th>Sales (AED)</th>
                                        <th>Avg. Sale/Call</th>
                                        <th>Complaints</th>
                                        <th>Performance</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                // Agent performance for the custom range
                const agentPerformance = {};
                
                // Initialize with all agents
                for (const agentId in agents) {
                    agentPerformance[agentId] = {
                        name: agents[agentId].name,
                        calls: 0,
                        sales: 0,
                        complaints: 0
                    };
                }
                
                // Calculate performance
                filteredLogs.forEach(log => {
                    if (agentPerformance[log.agent_id]) {
                        agentPerformance[log.agent_id].calls += 1;
                        agentPerformance[log.agent_id].sales += parseFloat(log.sale_amount || 0);
                    }
                });
                
                filteredComplaints.forEach(complaint => {
                    if (agentPerformance[complaint.agent_id]) {
                        agentPerformance[complaint.agent_id].complaints += 1;
                    }
                });
                
                // Sort by sales
                const sortedAgents = Object.entries(agentPerformance).sort((a, b) => b[1].sales - a[1].sales);
                
                sortedAgents.forEach(([agentId, perf]) => {
                    const avgSalePerCall = perf.calls > 0 ? perf.sales / perf.calls : 0;
                    const performanceClass = avgSalePerCall > 20 ? 'high' : avgSalePerCall > 10 ? 'medium' : 'low';
                    
                    reportHTML += `
                        <tr>
                            <td>${perf.name}</td>
                            <td>${perf.calls}</td>
                            <td>AED ${perf.sales.toFixed(2)}</td>
                            <td>AED ${avgSalePerCall.toFixed(2)}</td>
                            <td>${perf.complaints}</td>
                            <td>
                                <div class="performance-indicator performance-${performanceClass}"></div>
                            </td>
                        </tr>
                    `;
                });
                
                reportHTML += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }
            
            if (selectedMetrics.includes('branch')) {
                reportHTML += `
                    <div class="report-table">
                        <h5>Branch Performance</h5>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Branch</th>
                                        <th>Calls</th>
                                        <th>Sales (AED)</th>
                                        <th>Avg. Sale/Call</th>
                                        <th>Complaints</th>
                                        <th>Performance</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                // Branch performance for the custom range
                const branchPerformance = {};
                
                // Initialize with all branches
                branches.forEach(branch => {
                    branchPerformance[branch.id] = {
                        name: branch.name,
                        calls: 0,
                        sales: 0,
                        complaints: 0
                    };
                });
                
                // Calculate performance
                filteredLogs.forEach(log => {
                    if (branchPerformance[log.branch_id]) {
                        branchPerformance[log.branch_id].calls += 1;
                        branchPerformance[log.branch_id].sales += parseFloat(log.sale_amount || 0);
                    }
                });
                
                filteredComplaints.forEach(complaint => {
                    if (branchPerformance[complaint.branch_id]) {
                        branchPerformance[complaint.branch_id].complaints += 1;
                    }
                });
                
                // Sort by sales
                const sortedBranches = Object.entries(branchPerformance).sort((a, b) => b[1].sales - a[1].sales);
                
                sortedBranches.forEach(([branchId, perf]) => {
                    const avgSalePerCall = perf.calls > 0 ? perf.sales / perf.calls : 0;
                    const performanceClass = avgSalePerCall > 20 ? 'high' : avgSalePerCall > 10 ? 'medium' : 'low';
                    
                    reportHTML += `
                        <tr>
                            <td>${perf.name}</td>
                            <td>${perf.calls}</td>
                            <td>AED ${perf.sales.toFixed(2)}</td>
                            <td>AED ${avgSalePerCall.toFixed(2)}</td>
                            <td>${perf.complaints}</td>
                            <td>
                                <div class="performance-indicator performance-${performanceClass}"></div>
                            </td>
                        </tr>
                    `;
                });
                
                reportHTML += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }
            
            reportHTML += `
                    <div class="report-footer">
                        Report generated on ${new Date().toLocaleString()}
                    </div>
                </div>
            `;
            
            document.getElementById('customReportContent').innerHTML = reportHTML;
            
            // Initialize charts based on selected metrics
            if (selectedMetrics.includes('calls')) {
                // Group calls by date
                const callsByDate = {};
                filteredLogs.forEach(log => {
                    if (!callsByDate[log.date]) {
                        callsByDate[log.date] = 0;
                    }
                    callsByDate[log.date] += 1;
                });
                
                // Sort by date
                const sortedDates = Object.keys(callsByDate).sort();
                const labels = sortedDates.map(date => formatDate(date));
                const data = sortedDates.map(date => callsByDate[date]);
                
                const callsCtx = document.getElementById('customCallsChart').getContext('2d');
                new Chart(callsCtx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Calls',
                            data: data,
                            backgroundColor: 'rgba(228, 0, 43, 0.2)',
                            borderColor: 'rgba(228, 0, 43, 1)',
                            borderWidth: 2,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            if (selectedMetrics.includes('sales')) {
                // Group sales by date
                const salesByDate = {};
                filteredLogs.forEach(log => {
                    if (!salesByDate[log.date]) {
                        salesByDate[log.date] = 0;
                    }
                    salesByDate[log.date] += parseFloat(log.sale_amount || 0);
                });
                
                // Sort by date
                const sortedDates = Object.keys(salesByDate).sort();
                const labels = sortedDates.map(date => formatDate(date));
                const data = sortedDates.map(date => salesByDate[date]);
                
                const salesCtx = document.getElementById('customSalesChart').getContext('2d');
                new Chart(salesCtx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Sales (AED)',
                            data: data,
                            backgroundColor: 'rgba(228, 0, 43, 0.2)',
                            borderColor: 'rgba(228, 0, 43, 1)',
                            borderWidth: 2,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            if (selectedMetrics.includes('fcr')) {
                // Group FCR by date
                const fcrByDate = {};
                const callsByDate = {};
                const resolvedCallsByDate = {};
                
                filteredLogs.forEach(log => {
                    if (!callsByDate[log.date]) {
                        callsByDate[log.date] = 0;
                        resolvedCallsByDate[log.date] = 0;
                    }
                    callsByDate[log.date] += 1;
                    if (log.outcome === 'resolved' || log.outcome === 'order_placed') {
                        resolvedCallsByDate[log.date] += 1;
                    }
                });
                
                // Calculate FCR for each date
                Object.keys(callsByDate).forEach(date => {
                    fcrByDate[date] = callsByDate[date] > 0 ? (resolvedCallsByDate[date] / callsByDate[date]) * 100 : 0;
                });
                
                // Sort by date
                const sortedDates = Object.keys(fcrByDate).sort();
                const labels = sortedDates.map(date => formatDate(date));
                const data = sortedDates.map(date => fcrByDate[date]);
                
                const fcrCtx = document.getElementById('customFcrChart').getContext('2d');
                new Chart(fcrCtx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'FCR Rate (%)',
                            data: data,
                            backgroundColor: 'rgba(228, 0, 43, 0.2)',
                            borderColor: 'rgba(228, 0, 43, 1)',
                            borderWidth: 2,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }
            
            if (selectedMetrics.includes('aht')) {
                // Group AHT by date
                const ahtByDate = {};
                const callsByDate = {};
                const totalDurationByDate = {};
                
                filteredLogs.forEach(log => {
                    if (!callsByDate[log.date]) {
                        callsByDate[log.date] = 0;
                        totalDurationByDate[log.date] = 0;
                    }
                    callsByDate[log.date] += 1;
                    totalDurationByDate[log.date] += parseFloat(log.duration);
                });
                
                // Calculate AHT for each date
                Object.keys(callsByDate).forEach(date => {
                    ahtByDate[date] = callsByDate[date] > 0 ? totalDurationByDate[date] / callsByDate[date] : 0;
                });
                
                // Sort by date
                const sortedDates = Object.keys(ahtByDate).sort();
                const labels = sortedDates.map(date => formatDate(date));
                const data = sortedDates.map(date => ahtByDate[date]);
                
                const ahtCtx = document.getElementById('customAhtChart').getContext('2d');
                new Chart(ahtCtx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'AHT (minutes)',
                            data: data,
                            backgroundColor: 'rgba(228, 0, 43, 0.2)',
                            borderColor: 'rgba(228, 0, 43, 1)',
                            borderWidth: 2,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            if (selectedMetrics.includes('complaints')) {
                // Count complaints by type
                const complaintTypes = {};
                filteredComplaints.forEach(complaint => {
                    if (!complaintTypes[complaint.type]) {
                        complaintTypes[complaint.type] = 0;
                    }
                    complaintTypes[complaint.type] += 1;
                });
                
                // Sort by count
                const sortedComplaintTypes = Object.entries(complaintTypes).sort((a, b) => b[1] - a[1]);
                
                const labels = sortedComplaintTypes.map(([type, _]) => formatComplaintType(type));
                const data = sortedComplaintTypes.map(([_, count]) => count);
                
                const complaintsCtx = document.getElementById('customComplaintsChart').getContext('2d');
                new Chart(complaintsCtx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Complaints',
                            data: data,
                            backgroundColor: 'rgba(228, 0, 43, 0.7)',
                            borderColor: 'rgba(228, 0, 43, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
        }
        
        // Export report
        function exportReport(reportType) {
            showToast(`Export functionality for ${reportType} report would be implemented here`);
        }
        
        // Helper function to get week number
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
            return Math.ceil((((d - yearStart) / 86400000) + 1)/7);
        }
        
        // Refresh dashboard
        function refreshDashboard() {
            updateDashboard();
            initializeCharts();
            showToast('Dashboard refreshed');
        }
        
        // Export dashboard
        function exportDashboard() {
            showToast('Export functionality would be implemented here');
        }
        
        // Show toast notification
        function showToast(message, type = 'success') {
            // Create toast container if it doesn't exist
            let toastContainer = document.getElementById('toast-container');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.id = 'toast-container';
                toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
                document.body.appendChild(toastContainer);
            }
            
            const toastId = 'toast-' + Date.now();
            const toast = document.createElement('div');
            toast.id = toastId;
            toast.className = `toast align-items-center text-white bg-${type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'danger'} border-0`;
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            const bsToast = new bootstrap.Toast(toast, {
                autohide: true,
                delay: 3000
            });
            bsToast.show();
        }
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            
            // Set today's date as default for date inputs
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dailyDate').value = today;
            document.getElementById('complaintDate').value = today;
            
            // Set current month as default for month input
            const currentMonth = new Date().toISOString().slice(0, 7);
            document.getElementById('monthYear').value = currentMonth;
            
            // Set current week start as default for week input
            const todayDate = new Date();
            const weekStart = new Date(todayDate);
            weekStart.setDate(todayDate.getDate() - todayDate.getDay());
            document.getElementById('weekStart').value = weekStart.toISOString().split('T')[0];
        });
    </script>
</body>
</html>
